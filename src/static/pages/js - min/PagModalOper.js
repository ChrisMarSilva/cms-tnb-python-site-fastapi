function fCarregarModalCodigoAtivos(a,r,e,t){try{$("#selDetOperAtivo").empty(),$("#selDetOperAtivo").append('<option value="" selected>Selecione...</option>');var o="";"B"!=e&&"C"!=e||(o="lista_codigo_completo"),"A"!=e&&"V"!=e&&"D"!=e&&"G"!=e||(o="lista_codigo_user_comprado"),$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:a+"listas/"+o,success:function(r){var e=r.data.Resultado,o=r.data.Mensagem,l=r.data.Lista;return"NSESSAO"==e?($(location).attr("href",a+"/login"),!1):"NOK"==e?(fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_AVISO,o),!1):"FALHA"==e?(fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,o),!1):"OK"==e?(l.length>0&&$.each(l,function(a,r){$("#selDetOperAtivo").append('<option data-subtext=" - '+r[4]+'" value="'+r[0]+'">'+r[1]+"</option>")}),$("#selDetOperAtivo").val(t),fDefinirPadraoSelect("selDetOperAtivo"),!0):(fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,o),!1)},error:function(a){return fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO),!1}})}catch(a){fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fCalcularPrecoTotal(){}function fCalcularTaxaLiquid(){try{var a,r,e=0,t=0;a=GetValorInteiro($("#txtDetOperQuant").val()),(r=GetValorDecimal($("#txtDetOperPreco").val()))>0&&a>0&&(e=r*a),e>0&&(t=fCalcularJuros(e,.0275)),$("#txtDetOperTxLiquid").val(fMascaraValor(t)),fCalcularOperacao()}catch(a){fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fCalcularTaxaEmol(){try{var a,r,e=0,t=0;a=GetValorInteiro($("#txtDetOperQuant").val()),(r=GetValorDecimal($("#txtDetOperPreco").val()))>0&&a>0&&(e=r*a),e>0&&(t=fCalcularJuros(e,.003125)),$("#txtDetOperTxEmol").val(fMascaraValor(t)),fCalcularOperacao()}catch(a){fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fCalcularTaxaISS(){try{var a,r=0;(a=GetValorDecimal($("#txtDetOperTxCorret").val()))>0&&(r=a/100*9.65),$("#txtDetOperTxISS").val(fMascaraValor(r)),fCalcularOperacao()}catch(a){fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fCalcularTaxaIRRF(){try{var a,r,e=0,t=0;a=GetValorInteiro($("#txtDetOperQuant").val()),(r=GetValorDecimal($("#txtDetOperPreco").val()))>0&&a>0&&(e=r*a),e>0&&(t=fTrucarValor(fCalcularJuros(e,.005))),$("#txtDetOperTxIRRF").val(fMascaraValor(t))}catch(a){fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fCalcularOperacao(){try{var a,r="",e=0,t=0,o=0,l=0,A=0,i=0,p=0,O=0,d=0,s=0;$("#txtDetOperTipo").length&&(r=$("#txtDetOperTipo").val()),$("#txtDetOperQuant").length&&(e=GetValorInteiro($("#txtDetOperQuant").val())),$("#txtDetOperPreco").length&&(t=GetValorDecimal($("#txtDetOperPreco").val())),$("#txtDetOperTxLiquid").length&&(o=GetValorDecimal($("#txtDetOperTxLiquid").val())),$("#txtDetOperTxEmol").length&&(l=GetValorDecimal($("#txtDetOperTxEmol").val())),$("#txtDetOperTxCorret").length&&(A=GetValorDecimal($("#txtDetOperTxCorret").val())),$("#txtDetOperTxISS").length&&(i=GetValorDecimal($("#txtDetOperTxISS").val())),$("#txtDetOperTxIRRF").length&&(p=GetValorDecimal($("#txtDetOperTxIRRF").val())),$("#txtDetOperTxOutros").length&&(O=GetValorDecimal($("#txtDetOperTxOutros").val())),t>0&&e>0&&(d=parseFloat(parseFloat(t)*parseInt(e))),a=parseFloat(parseFloat(o)+parseFloat(l)+parseFloat(A)+parseFloat(i)+parseFloat(O)+parseFloat(p)),"C"==r&&(s=parseFloat(parseFloat(d)+parseFloat(a))),"V"==r&&(s=parseFloat(parseFloat(d)-parseFloat(a))),"B"==r&&(s=parseFloat(parseFloat(d)+parseFloat(a))),"A"==r&&(s=parseFloat(parseFloat(d)+parseFloat(a))),$("#txtDetOperTotal").val(fMascaraValor(s))}catch(a){fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fLimparDadosModalOper(a){fLimparAreaAlerta("AreaAlertaModalCadOper"),$("#txtDetOperId").val(""),$("#txtDetOperTipo").val(""),$("#txtDetOperData").val(""),$("#selDetOperAtivo").val(""),$("#txtDetOperQuant").val("0"),$("#txtDetOperPreco").val("0,00"),$("#selDetOperCorretora")[0].selectedIndex=2,$("#txtDetOperTxCorret").val("0,00"),$("#txtDetOperTxLiquid").val("0,00"),$("#txtDetOperTxEmol").val("0,00"),$("#txtDetOperTxISS").val("0,00"),$("#txtDetOperTxIRRF").val("0,00"),$("#txtDetOperTxOutros").val("0,00"),$("#txtDetOperTotal").val("0,00"),fDefinirPadraoSelect("selDetOperAtivo"),fDefinirPadraoSelect("selDetOperCorretora");var r=$("#selDetOperCorretora").val();null!=r&&""!=r&&fBuscarVlrCorretagem(a),$("#BtnDetOperQuantAtual").hide(),fCalcularOperacao()}function fAbrirModalDetalheOper(a,r,e,t,o,l,A,i){try{if(""==t)return fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_AVISO,"Tipo Inválido."),$("#PopModalDetalheOper").modal("hide"),!1;fLimparDadosModalOper(a),$("#txtDetOperTipo").val(t),"A"!=t&&"C"!=t&&"B"!=t&&"V"!=t||($("#DivDetOperPreco").show(),$("#DivDetOperCorretora").show()),"C"!=t&&"V"!=t||($("#DivDetOperTxCorret").show(),$("#DivDetOperTxLiquid").show(),$("#DivDetOperTxEmol").show(),$("#DivDetOperTxISS").show(),$("#DivDetOperTxOutros").show(),$("#DivDetOperTxIRRF").hide(),"V"==t&&$("#DivDetOperTxIRRF").show()),"D"!=t&&"G"!=t||($("#DivDetOperPreco").hide(),$("#DivDetOperCorretora").hide()),"A"!=t&&"B"!=t&&"D"!=t&&"G"!=t||($("#DivDetOperTxCorret").hide(),$("#DivDetOperTxLiquid").hide(),$("#DivDetOperTxEmol").hide(),$("#DivDetOperTxISS").hide(),$("#DivDetOperTxOutros").hide(),$("#DivDetOperTxIRRF").hide()),$("#PopModalDetalheOperTit").html(""),"C"==t&&"Novo"==e&&$("#PopModalDetalheOperTit").html("Nova Compra"),"C"==t&&"Visualizar"==e&&$("#PopModalDetalheOperTit").html("Visualizar Compra"),"C"==t&&"Alterar"==e&&$("#PopModalDetalheOperTit").html("Alterar Compra"),"V"==t&&"Novo"==e&&$("#PopModalDetalheOperTit").html("Nova Venda"),"V"==t&&"Visualizar"==e&&$("#PopModalDetalheOperTit").html("Visualizar Venda"),"V"==t&&"Alterar"==e&&$("#PopModalDetalheOperTit").html("Alterar Venda"),"B"==t&&"Novo"==e&&$("#PopModalDetalheOperTit").html("Nova Bonificação"),"B"==t&&"Visualizar"==e&&$("#PopModalDetalheOperTit").html("Visualizar Bonificação"),"B"==t&&"Alterar"==e&&$("#PopModalDetalheOperTit").html("Alterar Bonificação"),"D"==t&&"Novo"==e&&$("#PopModalDetalheOperTit").html("Novo Desdobramento"),"D"==t&&"Visualizar"==e&&$("#PopModalDetalheOperTit").html("Visualizar Desdobramento"),"D"==t&&"Alterar"==e&&$("#PopModalDetalheOperTit").html("Alterar Desdobramento"),"G"==t&&"Novo"==e&&$("#PopModalDetalheOperTit").html("Novo Grupamento"),"G"==t&&"Visualizar"==e&&$("#PopModalDetalheOperTit").html("Visualizar Grupamento"),"G"==t&&"Alterar"==e&&$("#PopModalDetalheOperTit").html("Alterar Grupamento"),"A"==t&&"Novo"==e&&$("#PopModalDetalheOperTit").html("Nova Amortização"),"A"==t&&"Visualizar"==e&&$("#PopModalDetalheOperTit").html("Visualizar Amortização"),"A"==t&&"Alterar"==e&&$("#PopModalDetalheOperTit").html("Alterar Amortização"),$("#BtnModalDetalheOperSalvar").show(),"Visualizar"==e&&$("#BtnModalDetalheOperSalvar").hide(),$("#DivDetOperTotal").hide(),"C"!=t&&"V"!=t&&"A"!=t&&"B"!=t||$("#DivDetOperTotal").show(),"Novo"==e&&($("#PopModalDetalheOper").modal({backdrop:"static"}),fCarregarModalCodigoAtivos(a,e,t,o),$("#selDetOperAtivo").val(o),fDefinirPadraoSelect("selDetOperAtivo"),$("#txtDetOperData").val(fDataAtual()),i&&""!=i&&$("#txtDetOperData").val(i),$("#txtDetOperQuant").val(GetValorInteiro(l)),"A"!=t&&"C"!=t&&"V"!=t||$("#txtDetOperPreco").val(A),"A"!=t&&"V"!=t&&"B"!=t||$("#BtnDetOperQuantAtual").show(),fCalcularOperacao()),"Alterar"!=e&&"Visualizar"!=e||fCarregarDadosModalDetalheOper(a,r,o,e),$("#selDivAtivo").focus()}catch(a){fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fCarregarDadosModalDetalheOper(a,r,e,t){try{if(""==r)return void fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_AVISO,"Id. Oper. não informado!");if(""==e)return void fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_AVISO,"Cód. Ativo não informado!");$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:a+"operacoes/carregar",data:{IdOper:r,CodAtivo:e},success:function(r){var e=r.data.Resultado,o=r.data.Mensagem,l=r.data.Dados;if("NSESSAO"==e)return $(location).attr("href",a+"/login"),!1;"NOK"==e?fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_AVISO,o):"FALHA"==e?fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,o):"OK"==e&&l.IdOper?(fCarregarModalCodigoAtivos(a,t,l.Tipo,l.CodAtivo),$("#txtDetOperId").val(l.IdOper),$("#txtDetOperTipo").val(l.Tipo),$("#txtDetOperData").val(l.Data),$("#selDetOperAtivo").val(l.CodAtivo),$("#txtDetOperQuant").val(l.Quant),$("#txtDetOperPreco").val(l.Preco),$("#selDetOperCorretora").val(l.Corretora),$("#txtDetOperTxCorret").val(l.TxCorret),$("#txtDetOperTxLiquid").val(l.TxLiquid),$("#txtDetOperTxEmol").val(l.TxEmol),$("#txtDetOperTxISS").val(l.TxISS),$("#txtDetOperTxIRRF").val(l.TxIRRF),$("#txtDetOperTxOutros").val(l.TxOutras),fCalcularOperacao(),fDefinirPadraoSelect("selDetOperAtivo"),fDefinirPadraoSelect("selDetOperCorretora"),$("#PopModalDetalheOper").modal({backdrop:"static"})):fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,o)},error:function(a){fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}})}catch(a){fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fBuscarVlrCorretagem(a){try{fLimparAreaAlerta("AreaAlertaModalCadOper"),$("#txtDetOperTxCorret").val("0,00"),fCalcularOperacao();var r=$("#selDetOperCorretora").val();if(""==r)return;$.ajax({dataType:"json",type:"post",url:a+"corretora/carregar",data:{IdCorret:r},success:function(r){var e=r.data.Resultado,t=r.data.Mensagem,o=r.data.Dados;return"NSESSAO"==e?($(location).attr("href",a+"/login"),!1):"NOK"==e?(fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_AVISO,t),!1):"FALHA"==e?void fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_ERRO,t):"OK"==e?(o.Id&&($("#txtDetOperTxCorret").val(o.Valor),fCalcularOperacao()),!0):(fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_ERRO,"Corretagem: "+t),!1)},error:function(a){fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_ERRO,"Corretagem: "+MSG_ALERTA_ERRO)}})}catch(a){fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_ERRO,"Corretagem: "+MSG_ALERTA_ERRO)}}function fBuscarQuantAtualOper(a){try{fLimparAreaAlerta("AreaAlertaModalCadOper"),$("#txtDetOperQuant").val("0");var r=$("#selDetOperAtivo").val().trim();if(""==r)return void fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_AVISO,"Ativo não informado!");$.ajax({dataType:"json",type:"post",url:a+"operacoes/quantidade",data:{CodAtivo:r},success:function(r){var e=r.data.Resultado,t=r.data.Mensagem,o=r.data.Dados;return"NSESSAO"==e?($(location).attr("href",a+"/login"),!1):"NOK"==e?(fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_AVISO,t),!1):"FALHA"==e?void fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_ERRO,t):"OK"==e?(o.QuantAtual&&($("#txtDetOperQuant").val(o.QuantAtual),fCalcularOperacao()),!0):(fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_ERRO,t),!1)},error:function(a){fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}})}catch(a){fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fBuscarPrecoAtualOper(a){try{fLimparAreaAlerta("AreaAlertaModalCadOper"),$("#txtDetOperPreco").val("0"),fCalcularOperacao();var r=$("#selDetOperAtivo").val().trim();if(""==r)return;$.ajax({dataType:"json",type:"post",url:a+"operacoes/precoatual",data:{CodAtivo:r},success:function(r){var e=r.data.Resultado,t=r.data.Mensagem,o=r.data.Dados;return"NSESSAO"==e?($(location).attr("href",a+"/login"),!1):"NOK"==e?(fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_AVISO,t),!1):"FALHA"==e?void fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_ERRO,t):"OK"==e?(o.PrecoAtual&&($("#txtDetOperPreco").val(o.PrecoAtual),fCalcularOperacao()),!0):(fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_ERRO,t),!1)},error:function(a){fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}})}catch(a){fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fValidarDadosOper(){try{fLimparAreaAlerta("AreaAlertaModalCadOper");var a=$("#txtDetOperTipo").val(),r=$("#selDetOperAtivo").val(),e=$("#txtDetOperData").val(),t=$("#txtDetOperQuant").val(),o=$("#txtDetOperPreco").val(),l="";return""==r&&(l+=" - Cód. Ativo/Fundo<br/>"),""==e&&(l+=" - Data<br/>"),""!=t&&"0"!=t||(l+=" - Quant<br/>"),"A"!=a&&"C"!=a&&"V"!=a||""!=o&&",00"!=o&&"0,00"!=o||(l+=" - Preço <br/>"),""==l||(fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_AVISO,"Os seguintes campos não estão preenchido: <br/>"+l),!1)}catch(a){return fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_ERRO,MSG_ALERTA_ERRO),!1}}function fSalvarDadosOper(a){try{if(!fValidarDadosOper())return;iniciarAnimacaoSalvar();var r=$("#txtDetOperId").val(),e=$("#txtDetOperTipo").val(),t=$("#selDetOperAtivo").val(),o=$("#txtDetOperData").val(),l=$("#txtDetOperQuant").val(),A="0"+$("#txtDetOperPreco").val(),i=$("#selDetOperCorretora").val(),p="0"+$("#txtDetOperTxCorret").val(),O="0"+$("#txtDetOperTxLiquid").val(),d="0"+$("#txtDetOperTxEmol").val(),s="0"+$("#txtDetOperTxISS").val(),c="0"+$("#txtDetOperTxIRRF").val(),D="0"+$("#txtDetOperTxOutros").val();$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:a+"operacoes/salvar",data:{Id:r,Tipo:e,Ativo:t,Data:o,Quant:l,Preco:A,Corretora:i,TxCorret:p,TxLiquid:O,TxEmol:d,TxISS:s,TxIRRF:c,TxOutros:D},success:function(t){finalizarAnimacaoSalvar();var o=t.data.Resultado,l=t.data.Mensagem;if("NSESSAO"==o)return $(location).attr("href",a+"/login"),!1;if("NOK"!=o)if("FALHA"!=o)if("OK"==o){var A=$(location).attr("pathname")||window.location.pathname,i=A.split("/").length-1;if(""!=A.split("/")[i].toUpperCase()&&(A=A.split("/")[i].toUpperCase()),A.toUpperCase()=="operacoes".toUpperCase()||A.toUpperCase()=="/operacoes/".toUpperCase()||A.toUpperCase()=="/operacoes".toUpperCase())""!=r||"C"!=e&&"V"!=e?($("#PopModalDetalheOper").modal("hide"),fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_SUCESSO,"Dados salvo com sucesso!")):(fLimparDadosModalOper(a),$("#txtDetOperTipo").val(e),"C"==e&&($("#txtDetOperData").val(fDataAtual()),$("#txtDetOperQuant").val("100")),"V"==e&&$("#BtnDetOperQuantAtual").show(),fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_SUCESSO,"Dados salvo com sucesso!")),buscar_todos_codigos_comprados(a,"selOperAtivo",!1,!0,!1,!0,!0,!0,!0);else if($("#PopModalDetalheOper").modal("hide"),A.toUpperCase()!="portfolio".toUpperCase()&&A.toUpperCase()!="/portfolio/".toUpperCase()&&A.toUpperCase()!="/portfolio".toUpperCase()||(fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_SUCESSO,"Dados salvo com sucesso!"),fRecarregarPagina(a)),A.toUpperCase()!="ativo".toUpperCase()&&A.toUpperCase()!="/ativo/".toUpperCase()&&A.toUpperCase()!="/ativo".toUpperCase()||(fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_SUCESSO,"Dados salvo com sucesso!"),fCarregarListaGrupos(a,"")),A.toUpperCase()=="CEI".toUpperCase()||A.toUpperCase()=="//CEI".toUpperCase()||A.toUpperCase()=="/CEI".toUpperCase())return fAlterarSitOperCei(a,PagCeiLstIdOper,"",PagCeiSitLanc,0,!1),void fProcurarAlterarLinhaGridOper(a,PagCeiLstIdxTr,PagCeiSitLanc);fCarregarGrid(a)}else fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_ERRO,l);else fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_ERRO,l);else fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_AVISO,l)},error:function(a,r,e){finalizarAnimacaoSalvar(),fCriarAlerta("AreaAlertaModalCadOper",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}})}catch(a){return finalizarAnimacaoSalvar(),void CriarAlertaModal(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}