function iniciarAnimacaoPesquisar(){$("#iRefresh").addClass("fa-spin"),$("#btnCotPesquisar").addClass("disabled"),$("#btnCotLimpar").addClass("disabled")}function finalizarAnimacaoPesquisa(){$("#iRefresh").removeClass("fa-spin"),$("#btnCotPesquisar").removeClass("disabled"),$("#btnCotLimpar").removeClass("disabled")}function fLimparGrid(a){$("#selFiltroSetor").val(""),$("#selFiltroSubSetor").val(""),$("#selFiltroSegmento").val(""),$("#selFiltroAtivo").val(""),fLimparSomenteGrid(a)}function fLimparSomenteGrid(a){try{finalizarAnimacaoPesquisa(),$("th").addClass("text-center"),$("#Grid").dataTable().fnClearTable(),$("#Grid").dataTable({bDestroy:!0}).fnDestroy(),$("#Grid").DataTable({oLanguage:fTraduzirGrid(),aoColumns:[{bSortable:!0,sWidth:"50px",targets:0},{bSortable:!0,sWidth:"50px",targets:1},{bSortable:!0,sWidth:"50px",targets:2},{bSortable:!0,sWidth:"50px",targets:3},{bSortable:!0,sWidth:"50px",targets:4},{bSortable:!0,sWidth:"50px",targets:5},{bSortable:!0,sWidth:"50px",targets:6}],bFilter:!0,searchable:!0,orderable:!0,bAutoWidth:!1})}catch(a){fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fMontarGrid(a,t){try{$("#Grid").DataTable({processing:!0,serverSide:!1,oLanguage:fTraduzirGrid(),data:t,aoColumns:[{bSortable:!0,sWidth:"50px",targets:0},{bSortable:!0,sWidth:"50px",targets:1,render:function(a,t,i){return"display"==t?"R$ "+i[1]:a}},{bSortable:!0,sWidth:"50px",targets:2,render:function(a,t,i){return"display"==t?"R$ "+i[2]:a}},{bSortable:!0,sWidth:"50px",targets:3,render:function(a,t,i){return"display"==t?"R$ "+i[3]:a}},{bSortable:!0,sWidth:"50px",targets:4,render:function(a,t,i){return"display"==t?i[4]+"%":a}},{bSortable:!0,sWidth:"50px",targets:5,render:function(a,t,i){return"display"==t?colcarFormacataoDataHora(i[5]):a}},{bSortable:!0,sWidth:"50px",targets:6,render:function(t,i,r){var o="";return"display"==i&&(CodAtivo=r[0],o+='<div class="btn-group btn-group-sm" role="group" aria-label="Basic example">',o+='<a class="btn btn-sm btn-warning btn-icon btn-icon-mini btn-round btn-simple" style="font-size:0.5rem;" title="Alterar Cotação '+CodAtivo+'" href="javascript:void(0);" onclick="fAbrirModalDetalheCot( \''+a+"', '"+CodAtivo+"' );\">",o+='   <i class="fa fa-pencil fa-lg" aria-hidden="true"></i> ',o+="</a>",o+="&nbsp;&nbsp;&nbsp;",o+='<a class="btn btn-sm btn-primary btn-icon btn-icon-mini btn-round btn-simple" style="font-size:0.5rem;" id="BtnAtuCotacao'+CodAtivo+'" title="Atualizar Cotação '+CodAtivo+'" href="javascript:void(0);" onclick="fAtualizarUnicaCotacao( \''+a+"', '"+CodAtivo+"', 0, 0 );\">",o+='   <i class="fa fa-refresh fa-sm" aria-hidden="true" id="iBtnAtuCotacao'+CodAtivo+'"></i> ',o+="</a>",o+="</div>"),o}}],createdRow:function(a,t,i){},initComplete:function(a,t){finalizarAnimacaoPesquisa()},bFilter:!0,bInfo:!0,bLengthChange:!1,searchable:!0,orderable:!0,bOrdering:!0,bSortable:!0,sAutoWidth:!1,bPaginate:!1,bAutoWidth:!1}),$(document).ajaxError(function(t,i,r,o){fLimparSomenteGrid(a),finalizarAnimacaoPesquisa()})}catch(t){fLimparSomenteGrid(a),finalizarAnimacaoPesquisa(),null!=t.description&&fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fCarregarGrid(a){try{fLimparAreaAlertaPrinc(),$("#Grid").dataTable().fnClearTable(),$("#Grid").dataTable({bDestroy:!0}).fnDestroy(),finalizarAnimacaoPesquisa(),iniciarAnimacaoPesquisar();var t=$("#selFiltroSetor").val().trim(),i=$("#selFiltroSubSetor").val().trim(),r=$("#selFiltroSegmento").val().trim(),o=$("#selFiltroAtivo").val().trim(),e=$("#selFiltroTipo").val().trim();$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:a+"cotacao/grid",data:{Setor:t,SubSetor:i,Segmento:r,CodAtivo:o,Tipo:e},success:function(t){var i=t.data.Resultado,r=t.data.Mensagem,o=t.data.Lista;return"NSESSAO"==i?($(location).attr("href",a+"/login"),!1):"NOK"==i?(finalizarAnimacaoPesquisa(),fLimparSomenteGrid(a),void fCriarAlertaPrinc(TP_ALERTA_AVISO,r)):"FALHA"==i?(finalizarAnimacaoPesquisa(),fLimparSomenteGrid(a),void fCriarAlertaPrinc(TP_ALERTA_ERRO,r)):"OK"!=i?(finalizarAnimacaoPesquisa(),fLimparSomenteGrid(a),void fCriarAlertaPrinc(TP_ALERTA_ERRO,r)):void fMontarGrid(a,o)},error:function(t){return finalizarAnimacaoPesquisa(),fLimparSomenteGrid(a),fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO),!1}})}catch(t){finalizarAnimacaoPesquisa(),fLimparSomenteGrid(a),null!=t.description&&fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fLimparDadosModalCot(){fLimparAreaAlertaModalCad(),$("#txtCadCotAtivo").val(""),$("#txtCadCotFechamento").val(""),$("#txtCadCotVlrAnterior").val(""),$("#txtCadCotVariacao").val("")}function fAbrirModalDetalheCot(a,t){fLimparDadosModalCot(),fCarregarDadosModalDetalheCot(a,t)}function fCarregarDadosModalDetalheCot(a,t){try{if(""==t)return void fCriarAlertaPrinc(TP_ALERTA_AVISO,"Ativo não informado!");$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:a+"cotacao/carregar",data:{CodAtivo:t},success:function(t){var i=t.data.Resultado,r=t.data.Mensagem,o=t.data.Dados;if("NSESSAO"==i)return $(location).attr("href",a+"/login"),!1;"NOK"==i?fCriarAlertaPrinc(TP_ALERTA_AVISO,r):"FALHA"==i?fCriarAlertaPrinc(TP_ALERTA_ERRO,r):"OK"==i&&o.Ativo?($("#txtCadCotAtivo").val(o.Ativo),$("#txtCadCotFechamento").val(o.Fechamento),$("#txtCadCotVlrAnterior").val(o.VlrAnterior),$("#txtCadCotVariacao").val(o.Variacao),$("#PopModalDetalheCotacao").modal({backdrop:"static"})):fCriarAlertaPrinc(TP_ALERTA_ERRO,r)},error:function(a){fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}})}catch(a){fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fValidarDados(){try{fLimparAreaAlertaModalCad();var a=$("#txtCadCotAtivo").val(),t=$("#txtCadCotFechamento").val(),i=$("#txtCadCotVlrAnterior").val(),r=$("#txtCadCotVariacao").val(),o="";return""==a&&(o+=" - Ativo<br/>"),""==t&&(o+=" - Fechamento<br/>"),""==i&&(o+=" - Vlr. Anterior<br/>"),""==r&&(o+=" - Variação<br/>"),""==o||(fCriarAlertaModalCad(TP_ALERTA_AVISO,"Os seguintes campos não estão preenchido: <br/>"+o),!1)}catch(a){return fCriarAlertaModalCad(TP_ALERTA_ERRO,MSG_ALERTA_ERRO),!1}}function iniciarAnimacaoAtualizacao(a=""){$("#BtnAtuCotacao"+a).addClass("disabled"),$("#BtnAtuCotacao"+a).removeClass("btn-simple"),$("#iBtnAtuCotacao"+a).removeClass("fa-refresh"),$("#iBtnAtuCotacao"+a).addClass("fa-spinner"),$("#iBtnAtuCotacao"+a).addClass("fa-pulse")}function finalizarAnimacaoAtualizacao(a=""){$("#BtnAtuCotacao"+a).removeClass("disabled"),$("#BtnAtuCotacao"+a).addClass("btn-simple"),$("#iBtnAtuCotacao"+a).removeClass("fa-spinner"),$("#iBtnAtuCotacao"+a).removeClass("fa-pulse"),$("#iBtnAtuCotacao"+a).addClass("fa-refresh")}function fSalvarDadosCot(a){try{if(!fValidarDados())return!1;finalizarAnimacaoSalvar(),iniciarAnimacaoSalvar();var t=$("#txtCadCotAtivo").val(),i=$("#txtCadCotFechamento").val(),r=$("#txtCadCotVlrAnterior").val(),o=$("#txtCadCotVariacao").val();finalizarAnimacaoAtualizacao(t),iniciarAnimacaoAtualizacao(t),$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:a+"cotacao/salvar",data:{CodAtivo:t,VlrFechamento:i,VlrAnterior:r,Variacao:o},success:function(i){finalizarAnimacaoSalvar(),finalizarAnimacaoAtualizacao(t);var r=i.data.Resultado,o=i.data.Mensagem;if("NSESSAO"==r)return $(location).attr("href",a+"/login"),!1;"NOK"!=r?"FALHA"!=r&&"OK"==r?(fLimparDadosModalCot(),$("#PopModalDetalheCotacao").modal("hide"),fCarregarGrid(a)):fCriarAlertaModalCad(TP_ALERTA_ERRO,o):fCriarAlertaModalCad(TP_ALERTA_AVISO,o)},error:function(a){finalizarAnimacaoSalvar(),finalizarAnimacaoAtualizacao(t),fCriarAlertaModalCad(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}})}catch(a){return finalizarAnimacaoSalvar(),finalizarAnimacaoAtualizacao(t),void CriarAlertaModal(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fAtualizarTodasCotacoes(a){try{finalizarAnimacaoAtualizacao(""),iniciarAnimacaoAtualizacao("");var t=0,i=$("#Grid > tbody > tr").length;$("#Grid > tbody > tr").each(function(){t++;var r=$(this).find("td").eq(0).html();fAtualizarUnicaCotacao(a,r,t,i)})}catch(a){return finalizarAnimacaoAtualizacao(""),void fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fAtualizarUnicaCotacao(a,t="",i=0,r=0){try{promise=new Promise((i,r)=>{""!=t?(finalizarAnimacaoAtualizacao(t),iniciarAnimacaoAtualizacao(t),$("#Grid > tbody > tr").each(function(){if(t==$(this).find("td").eq(0).html())return $(this).find("td").eq(1).html(""),$(this).find("td").eq(2).html(""),$(this).find("td").eq(3).html(""),$(this).find("td").eq(4).html(""),$(this).find("td").eq(5).html(""),!1}),$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:a+"cotacao/AtualizaCotacao",data:{CodAtivo:t},success:function(r){var o=r.data.Resultado,e=r.data.Mensagem,n=r.data.Dados;if(i(!0),"NSESSAO"==o)return $(location).attr("href",a+"/login"),!1;"NOK"==o?(finalizarAnimacaoAtualizacao(t),fCriarAlertaPrinc(TP_ALERTA_AVISO,"Ativo: "+t+" - "+e)):"FALHA"==o?(finalizarAnimacaoAtualizacao(t),fCriarAlertaPrinc(TP_ALERTA_ERRO,"Ativo: "+t+" - "+e)):"OK"==o&&n.Ativo?$("#Grid > tbody > tr").each(function(){if(n.Ativo==$(this).find("td").eq(0).html())return $(this).find("td").eq(1).html("R$ "+n.Fechamento),$(this).find("td").eq(2).html("R$ "+n.VlrAnterior),$(this).find("td").eq(3).html("R$ "+n.VlrVariacao),$(this).find("td").eq(4).html(n.PercVariacao+"%"),$(this).find("td").eq(5).html(colcarFormacataoDataHora(n.DtHrAtualizacao)),!1}):(finalizarAnimacaoAtualizacao(t),fCriarAlertaPrinc(TP_ALERTA_ERRO,"Ativo: "+t+" - "+e))},error:function(a,i,r){finalizarAnimacaoAtualizacao(t),fCriarAlertaPrinc(TP_ALERTA_ERRO,"Ativo: "+t+" - "+a.responseText)}})):fCriarAlertaPrinc(TP_ALERTA_AVISO,"Ativo não informado!")}).then(a=>{finalizarAnimacaoAtualizacao(t),i==r&&finalizarAnimacaoAtualizacao("")}).catch(a=>{finalizarAnimacaoAtualizacao(t),i==r&&finalizarAnimacaoAtualizacao(""),fCriarAlertaPrinc(TP_ALERTA_ERRO,"Ativo: "+t+" - "+MSG_ALERTA_ERRO)})}catch(a){return finalizarAnimacaoAtualizacao(t),i==r&&finalizarAnimacaoAtualizacao(""),void fCriarAlertaPrinc(TP_ALERTA_ERRO,"Ativo: "+t+" - "+MSG_ALERTA_ERRO)}}$(document).ready(function(){$("#MnPrincCotacao").addClass("active open"),fLimparAreaAlertaPrinc(),fLimparAreaAlertaModalCad()});