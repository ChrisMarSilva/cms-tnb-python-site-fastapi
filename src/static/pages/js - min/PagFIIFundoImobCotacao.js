function fLimparGrid(a){try{$("th").addClass("text-center"),$("#Grid").dataTable().fnClearTable(),$("#Grid").dataTable({bDestroy:!0}).fnDestroy(),$("#Grid").DataTable({oLanguage:fTraduzirGrid(),aoColumns:[{bSortable:!0,sWidth:"50px",targets:0},{bSortable:!0,sWidth:"50px",targets:1},{bSortable:!0,sWidth:"50px",targets:2},{bSortable:!0,sWidth:"50px",targets:3},{bSortable:!0,sWidth:"50px",targets:4},{bSortable:!0,sWidth:"50px",targets:5},{bSortable:!0,sWidth:"50px",targets:6}],bFilter:!0,searchable:!0,orderable:!0,bAutoWidth:!1})}catch(a){fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fMontarGrid(a,t){try{$("#Grid").DataTable({processing:!0,serverSide:!1,oLanguage:fTraduzirGrid(),data:t,aoColumns:[{bSortable:!0,sWidth:"50px",targets:0},{bSortable:!0,sWidth:"50px",targets:1,render:function(a,t,r){return"display"==t?"R$ "+r[1]:a}},{bSortable:!0,sWidth:"50px",targets:2,render:function(a,t,r){return"display"==t?"R$ "+r[2]:a}},{bSortable:!0,sWidth:"50px",targets:3,render:function(a,t,r){return"display"==t?"R$ "+r[3]:a}},{bSortable:!0,sWidth:"50px",targets:4,render:function(a,t,r){return"display"==t?r[4]+"%":a}},{bSortable:!0,sWidth:"50px",targets:5,render:function(a,t,r){return"display"==t?colcarFormacataoDataHora(r[5]):a}},{bSortable:!0,sWidth:"50px",targets:6,render:function(t,r,i){var o="";return"display"==r&&(CodAtivo=i[0],o+='<div class="btn-group btn-group-sm" role="group" aria-label="Basic example">',o+='<a class="btn btn-sm btn-warning btn-icon btn-icon-mini btn-round btn-simple" style="font-size:0.5rem;" title="Alterar Cotação '+CodAtivo+'" href="javascript:void(0);" onclick="fAbrirModalDetalheFundoImobCot( \''+a+"', '"+CodAtivo+"' );\">",o+='   <i class="fa fa-pencil fa-lg" aria-hidden="true"></i> ',o+="</a>",o+="&nbsp;&nbsp;&nbsp;",o+='<a class="btn btn-sm btn-primary btn-icon btn-icon-mini btn-round btn-simple" style="font-size:0.5rem;" id="BtnAtuCotacao'+CodAtivo+'" title="Atualizar Cotação '+CodAtivo+'" href="javascript:void(0);" onclick="fAtualizarUnicaCotacao( \''+a+"', '"+CodAtivo+"', 0, 0 );\">",o+='   <i class="fa fa-refresh fa-sm" aria-hidden="true" id="iBtnAtuCotacao'+CodAtivo+'"></i> ',o+="</a>",o+="</div>"),o}}],createdRow:function(a,t,r){},initComplete:function(a,t){},bFilter:!0,bInfo:!0,bLengthChange:!1,searchable:!0,orderable:!0,bOrdering:!0,bSortable:!0,sAutoWidth:!1,bPaginate:!1,bAutoWidth:!1}),$(document).ajaxError(function(t,r,i,o){fLimparGrid(a)})}catch(t){fLimparGrid(a),null!=t.description&&fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fCarregarGrid(a){try{fLimparAreaAlertaPrinc(),$("#Grid").dataTable().fnClearTable(),$("#Grid").dataTable({bDestroy:!0}).fnDestroy(),$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:a+"FiiFundoImobCotacao/grid",data:{},success:function(t){var r=t.data.Resultado,i=t.data.Mensagem,o=t.data.Lista;return"NSESSAO"==r?($(location).attr("href",a+"/login"),!1):"NOK"==r?(fLimparGrid(a),void fCriarAlertaPrinc(TP_ALERTA_AVISO,i)):"FALHA"==r?(fLimparGrid(a),void fCriarAlertaPrinc(TP_ALERTA_ERRO,i)):"OK"!=r?(fLimparGrid(a),void fCriarAlertaPrinc(TP_ALERTA_ERRO,i)):void fMontarGrid(a,o)},error:function(t){return fLimparGrid(a),fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO),!1}})}catch(t){fLimparGrid(a),null!=t.description&&fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fLimparDadosModalFundoImobCot(){fLimparAreaAlertaModalCad(),$("#txtCadCotFundo").val(""),$("#txtCadCotFechamento").val(""),$("#txtCadCotVlrAnterior").val(""),$("#txtCadCotVariacao").val("")}function fAbrirModalDetalheFundoImobCot(a,t){fLimparDadosModalFundoImobCot(),fCarregarDadosModalDetalheFundoImobCot(a,t)}function fCarregarDadosModalDetalheFundoImobCot(a,t){try{if(""==t)return void fCriarAlertaPrinc(TP_ALERTA_AVISO,"Codigo do Fundo Imob. não informado!");$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:a+"FiiFundoImobCotacao/carregar",data:{fiiFundoCodigo:t},success:function(t){var r=t.data.Resultado,i=t.data.Mensagem,o=t.data.Dados;if("NSESSAO"==r)return $(location).attr("href",a+"/login"),!1;"NOK"==r?fCriarAlertaPrinc(TP_ALERTA_AVISO,i):"FALHA"==r?fCriarAlertaPrinc(TP_ALERTA_ERRO,i):"OK"==r&&o.Fundo?($("#txtCadCotFundo").val(o.Fundo),$("#txtCadCotFechamento").val(o.Fechamento),$("#txtCadCotVlrAnterior").val(o.VlrAnterior),$("#txtCadCotVariacao").val(o.Variacao),$("#PopModalDetalheFundoImobCotacao").modal({backdrop:"static"})):fCriarAlertaPrinc(TP_ALERTA_ERRO,i)},error:function(a){fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}})}catch(a){fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fValidarDadosFundoImobCot(){try{fLimparAreaAlertaModalCad();var a=$("#txtCadCotFundo").val(),t=$("#txtCadCotFechamento").val(),r=$("#txtCadCotVlrAnterior").val(),i=$("#txtCadCotVariacao").val(),o="";return""==a&&(o+=" - Fundo<br/>"),""==t&&(o+=" - Fechamento<br/>"),""==r&&(o+=" - Vlr. Anterior<br/>"),""==i&&(o+=" - Variação<br/>"),""==o||(fCriarAlertaModalCad(TP_ALERTA_AVISO,"Os seguintes campos não estão preenchido: <br/>"+o),!1)}catch(a){return fCriarAlertaModalCad(TP_ALERTA_ERRO,MSG_ALERTA_ERRO),!1}}function iniciarAnimacaoAtualizacao(a=""){$("#BtnAtuCotacao"+a).addClass("disabled"),$("#BtnAtuCotacao"+a).removeClass("btn-simple"),$("#iBtnAtuCotacao"+a).removeClass("fa-refresh"),$("#iBtnAtuCotacao"+a).addClass("fa-spinner"),$("#iBtnAtuCotacao"+a).addClass("fa-pulse")}function finalizarAnimacaoAtualizacao(a=""){$("#BtnAtuCotacao"+a).removeClass("disabled"),$("#BtnAtuCotacao"+a).addClass("btn-simple"),$("#iBtnAtuCotacao"+a).removeClass("fa-spinner"),$("#iBtnAtuCotacao"+a).removeClass("fa-pulse"),$("#iBtnAtuCotacao"+a).addClass("fa-refresh")}function fSalvarDadosFundoImobCot(a){try{if(!fValidarDadosFundoImobCot())return!1;finalizarAnimacaoSalvar(),iniciarAnimacaoSalvar();var t=$("#txtCadCotFundo").val(),r=$("#txtCadCotFechamento").val(),i=$("#txtCadCotVlrAnterior").val(),o=$("#txtCadCotVariacao").val();finalizarAnimacaoAtualizacao(Fundo),iniciarAnimacaoAtualizacao(Fundo),$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:a+"FiiFundoImobCotacao/salvar",data:{fiiFundoCodigo:t,VlrFechamento:r,VlrAnterior:i,Variacao:o},success:function(r){finalizarAnimacaoSalvar(),finalizarAnimacaoAtualizacao(t);var i=r.data.Resultado,o=r.data.Mensagem;if("NSESSAO"==i)return $(location).attr("href",a+"/login"),!1;"NOK"!=i?"FALHA"!=i&&"OK"==i?(fLimparDadosModalFundoImobCot(),$("#PopModalDetalheFundoImobCotacao").modal("hide"),fCarregarGrid(a)):fCriarAlertaModalCad(TP_ALERTA_ERRO,o):fCriarAlertaModalCad(TP_ALERTA_AVISO,o)},error:function(a){finalizarAnimacaoSalvar(),finalizarAnimacaoAtualizacao(t),fCriarAlertaModalCad(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}})}catch(a){return finalizarAnimacaoSalvar(),finalizarAnimacaoAtualizacao(t),void CriarAlertaModal(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fAtualizarTodasCotacoes(a){try{finalizarAnimacaoAtualizacao(""),iniciarAnimacaoAtualizacao("");var t=0,r=$("#Grid > tbody > tr").length;$("#Grid > tbody > tr").each(function(){t++;var i=$(this).find("td").eq(0).html();fAtualizarUnicaCotacao(a,i,t,r)})}catch(a){return finalizarAnimacaoAtualizacao(""),void fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fAtualizarUnicaCotacao(a,t="",r=0,i=0){try{promise=new Promise((r,i)=>{""!=t?(finalizarAnimacaoAtualizacao(t),iniciarAnimacaoAtualizacao(t),$("#Grid > tbody > tr").each(function(){if(t==$(this).find("td").eq(0).html())return $(this).find("td").eq(1).html(""),$(this).find("td").eq(2).html(""),$(this).find("td").eq(3).html(""),$(this).find("td").eq(4).html(""),$(this).find("td").eq(5).html(""),!1}),$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:a+"FiiFundoImobCotacao/AtualizaCotacao",data:{fiiFundoCodigo:t},success:function(i){var o=i.data.Resultado,n=i.data.Mensagem,e=i.data.Dados;if(r(!0),"NSESSAO"==o)return $(location).attr("href",a+"/login"),!1;"NOK"==o?(finalizarAnimacaoAtualizacao(t),fCriarAlertaPrinc(TP_ALERTA_AVISO,"Ativo: "+t+" - "+n)):"FALHA"==o?(finalizarAnimacaoAtualizacao(t),fCriarAlertaPrinc(TP_ALERTA_ERRO,"Ativo: "+t+" - "+n)):"OK"==o&&e.Fundo?$("#Grid > tbody > tr").each(function(){if(e.Fundo==$(this).find("td").eq(0).html())return $(this).find("td").eq(1).html("R$ "+e.Fechamento),$(this).find("td").eq(2).html("R$ "+e.VlrAnterior),$(this).find("td").eq(3).html("R$ "+e.VlrVariacao),$(this).find("td").eq(4).html(e.PercVariacao+"%"),$(this).find("td").eq(5).html(colcarFormacataoDataHora(e.DtHrAtualizacao)),!1}):(finalizarAnimacaoAtualizacao(t),fCriarAlertaPrinc(TP_ALERTA_ERRO,"Fundo: "+t+" - "+n))},error:function(a,r,i){finalizarAnimacaoAtualizacao(t),fCriarAlertaPrinc(TP_ALERTA_ERRO,"Fundo: "+t+" - "+a.responseText)}})):fCriarAlertaPrinc(TP_ALERTA_AVISO,"Ativo não informado!")}).then(a=>{finalizarAnimacaoAtualizacao(t),r==i&&finalizarAnimacaoAtualizacao("")}).catch(a=>{finalizarAnimacaoAtualizacao(t),r==i&&finalizarAnimacaoAtualizacao(""),fCriarAlertaPrinc(TP_ALERTA_ERRO,"Fundo: "+t+" - "+MSG_ALERTA_ERRO)})}catch(a){return finalizarAnimacaoAtualizacao(t),r==i&&finalizarAnimacaoAtualizacao(""),void fCriarAlertaPrinc(TP_ALERTA_ERRO,"Fundo: "+t+" - "+MSG_ALERTA_ERRO)}}$(document).ready(function(){$("#MnPrincFiiFundoImobCotacao").addClass("active open"),fLimparAreaAlertaPrinc(),fLimparAreaAlertaModalCad()});