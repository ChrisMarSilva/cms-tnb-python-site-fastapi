var PagCeiSitLanc="",PagCeiLstIdxTr=[],PagCeiLstIdOper=[],PagCeiLstIdProv=[];function fAbrirModalDadosCei(){try{fLimparAreaAlerta("AlertaModalDadosCei"),$("#txtDetCeiCpf").val(FormatarCPFCNPJ(CeiCpf)),$("#txtDetCeiSenha").val(""),$("#txtDetCeiDtHrDescr").html(CeiDtHrDescr),$("#txtDetCeiSitDescr").removeClass("text-muted"),$("#txtDetCeiSitDescr").removeClass("text-success"),$("#txtDetCeiSitDescr").removeClass("text-danger"),"A"==CeiSit?($("#txtDetCeiSitDescr").html("Habilitada"),$("#txtDetCeiSitDescr").addClass("text-success")):"I"==CeiSit?($("#txtDetCeiSitDescr").html("Desabilitada"),$("#txtDetCeiSitDescr").addClass("text-danger")):($("#txtDetCeiSitDescr").html("Desconhedida"),$("#txtDetCeiSitDescr").addClass("table-muted")),$("#PopModalDadosCEI").modal({backdrop:"static"}),$("#txtDetCeiCpf").focus()}catch(r){fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function iniciarAnimacaoSalvarCei(){$("#iDadosCeiSalvar").removeClass("fa-check"),$("#iDadosCeiSalvar").addClass("fa-spinner"),$("#iDadosCeiSalvar").addClass("fa-pulse"),$("#BtnModalDadosCeiSalvar").addClass("disabled")}function finalizarAnimacaoSalvarCei(){$("#iDadosCeiSalvar").removeClass("fa-spinner"),$("#iDadosCeiSalvar").removeClass("fa-pulse"),$("#iDadosCeiSalvar").addClass("fa-check"),$("#BtnModalDadosCeiSalvar").removeClass("disabled")}async function fSalvarDadosCei(r){try{promise=new Promise((i,a)=>{fLimparAreaAlertaPrinc(),finalizarAnimacaoSalvarCei(),iniciarAnimacaoSalvarCei();var t=tirarFormacataoCPFCNPJ($("#txtDetCeiCpf").val().trim()),e=$("#txtDetCeiSenha").val().trim();if(""!=t){if(!ValidarCPF(document.getElementById("txtDetCeiCpf")))return finalizarAnimacaoSalvarCei(),void fCriarAlerta("AlertaModalDadosCei",TP_ALERTA_AVISO,"CPF inválido!");if(""==e)return finalizarAnimacaoSalvarCei(),void fCriarAlerta("AlertaModalDadosCei",TP_ALERTA_AVISO,"Senha não informada!")}if(""!=e&&""==t)return finalizarAnimacaoSalvarCei(),void fCriarAlerta("AlertaModalDadosCei",TP_ALERTA_AVISO,"CPF não informado!");$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:r+"cei/salvar",data:{txtCPF:t,txtSenha:e},success:function(i){finalizarAnimacaoSalvarCei();var a=i.data.Resultado,t=i.data.Mensagem,e=i.data.Dados;if("NSESSAO"==a)return $(location).attr("href",r+"/login"),!1;"NOK"!=a?"OK"==a?(CeiCpf=FormatarCPFCNPJ(e.Cpf),CeiSit=e.Sit,$("#PopModalDadosCEI").modal("hide"),"A"==CeiSit?fCriarAlertaPrinc(TP_ALERTA_SUCESSO,"Importação Habilitada com Sucesso!"):fCriarAlertaPrinc(TP_ALERTA_SUCESSO,"Importação Desabilitada com Sucesso!")):fCriarAlertaPrinc(TP_ALERTA_ERRO,t):fCriarAlertaPrinc(TP_ALERTA_AVISO,t)},error:function(r,i,a){finalizarAnimacaoSalvarCei(),fCriarAlerta("AlertaModalDadosCei",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}),i(!0)}).then(r=>{}).catch(r=>{finalizarAnimacaoSalvarCei(),fCriarAlerta("AlertaModalDadosCei",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(r){return finalizarAnimacaoSalvarCei(),void fCriarAlerta("AlertaModalDadosCei",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function iniciarAnimacaoPesquisar(){$("#iRefresh").addClass("fa-spin"),$("#btnCeiPesquisar").addClass("disabled")}function finalizarAnimacaoPesquisa(){$("#iRefresh").removeClass("fa-spin"),$("#btnCeiPesquisar").removeClass("disabled")}function fLimparGrid(r){$("#selCeiAtivo").val(""),$("#txtCeiDataIni").val(fDataPrimeira()),$("#txtCeiDataFim").val(fDataUltima()),fLimparSomenteGrid(r)}async function fLimparSomenteGrid(r){try{promise=new Promise((r,i)=>{finalizarAnimacaoPesquisa(),$("#Grid").length<=0||($("th").addClass("text-center"),$("#Grid").dataTable().fnClearTable(),$("#Grid").dataTable({bDestroy:!0}).fnDestroy(),$("#Grid").DataTable({data:[],oLanguage:fTraduzirGrid(),aoColumns:[{bSortable:!1,sWidth:widthGridSel,targets:idxGridSel},{bSortable:!1,sWidth:widthGridData,targets:idxGridData},{bSortable:!1,sWidth:widthGridTipo,targets:idxGridTipo},{bSortable:!1,sWidth:widthGridAtivo,targets:idxGridAtivo},{bSortable:!1,sWidth:widthGridQuant,targets:idxGridQuant},{bSortable:!1,sWidth:widthGridPreco,targets:idxGridPreco},{bSortable:!1,sWidth:widthGridTotal,targets:idxGridTotal},{bSortable:!1,sWidth:widthGridCorret,targets:idxGridCorret},{bSortable:!1,sWidth:widthGridSitDescr,targets:idxGridSitDescr},{visible:!1,targets:idxGridIdOper},{visible:!1,targets:idxGridIdSit},{bSortable:!1,sWidth:widthGridAcao,targets:idxGridAcao}],bLengthChange:!1,bFilter:!1,searchable:!0,orderable:!1,bAutoWidth:!1}),r(!0))}).then(r=>{}).catch(r=>{fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(r){fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fMontarGrid(r,i){try{promise=new Promise((a,t)=>{var e=-1;$("#Grid").DataTable({processing:!0,serverSide:!1,oLanguage:fTraduzirGrid(),data:i,aoColumns:[{bSortable:!1,sWidth:widthGridSel,targets:idxGridSel,render:function(r,i,a){if("display"==i)var t=a[idxGridIdSit];return"I"==t?"<input class='check-cei-oper' type='checkbox' id='ckSelOper-"+a[idxGridIdOper]+"'/>":r}},{bSortable:!1,sWidth:widthGridData,targets:idxGridData,render:function(r,i,a){return"display"==i?colcarFormacataoData(a[idxGridData]):r}},{bSortable:!1,sWidth:widthGridTipo,targets:idxGridTipo,render:function(r,i,a){return"display"==i?a[idxGridTipo]:r}},{bSortable:!1,sWidth:widthGridAtivo,targets:idxGridAtivo,render:function(r,i,a){return"display"==i?a[idxGridAtivo]:r}},{bSortable:!1,sWidth:widthGridQuant,targets:idxGridQuant,render:function(r,i,a){return"display"==i?colcarFormacataoInteiro(a[idxGridQuant]):r}},{bSortable:!1,sWidth:widthGridPreco,targets:idxGridPreco,render:function(r,i,a){return"display"==i?"R$ "+a[idxGridPreco]:r}},{bSortable:!1,sWidth:widthGridTotal,targets:idxGridTotal,render:function(r,i,a){return"display"==i?"R$ "+a[idxGridTotal]:r}},{bSortable:!1,sWidth:widthGridCorret,targets:idxGridCorret,render:function(r,i,a){return"display"==i?a[idxGridCorret]:r}},{bSortable:!1,sWidth:widthGridSitDescr,targets:idxGridSitDescr,render:function(r,i,a){return"display"==i?a[idxGridSitDescr]:r}},{visible:!1,targets:idxGridIdOper,render:function(r,i,a){return"display"==i?a[idxGridIdOper]:r}},{visible:!1,targets:idxGridIdSit,render:function(r,i,a){return"display"==i?a[idxGridIdSit]:r}},{bSortable:!1,sWidth:widthGridAcao,targets:idxGridAcao,render:function(i,a,t){var d="",o="",n="",s="";if("display"==a){e+=1;var l=colcarFormacataoDataXML(t[idxGridData]),c=t[idxGridTipo].toUpperCase().substring(0,1),P=t[idxGridAtivo],A=parseFloat(GetValorInteiro(t[idxGridQuant])),f=parseFloat(GetValorDecimal(t[idxGridPreco])),v=t[idxGridIdOper],u=t[idxGridIdSit];n="",s="success","L"!=u&&"C"!=u||(n=" disabled",s="muted"),d+='<div class="btn-group btn-group-sm" role="group" aria-label="Basic example">',d+='<a id="BtnAddOper-'+e+'" class="btn btn-sm btn-'+s+" btn-icon btn-icon-mini btn-round btn-simple"+n+'"'+n+' style="font-size:0.5rem; " title="Adicionar Operação Ativo '+P+'" href="javascript:void(0);" onclick="fAbrirModalDetalheOperLocal( \''+r+"', '', 'Novo', '"+c+"', '"+P+"', '"+A+"', '"+fMascaraValor(f)+"', '"+l+"', '"+e+"', '"+v+"' );\">",d+='   <i class="fa fa-plus-square fa-lg" aria-hidden="true"></i> ',d+="</a>",n="",s="info","L"!=u&&"C"!=u||(n=" disabled",s="muted"),o+='<a id="BtnConfOper-'+e+'" class="btn btn-sm btn-'+s+" btn-icon btn-icon-mini btn-round btn-simple"+n+'"'+n+' style="font-size:0.5rem;" title="Marcar como Conferida Operação Ativo '+P+'" href="javascript:void(0);" onclick="fAlterarSitOperCei( \''+r+"', '', '"+v+"', 'C', '"+e+"' );\">",o+='   <i class="fa fa-check fa-lg" aria-hidden="true"></i> ',o+="</a>",o+="</div>"}return d+"&nbsp;"+o}}],createdRow:function(r,i,a){var t=i[idxGridIdSit];$("td",r).addClass("text-center"),"I"==t?$("td",r).addClass("text-dark"):"L"==t?$("td",r).addClass("text-success"):"C"==t&&$("td",r).addClass("text-primary")},initComplete:function(r,i){finalizarAnimacaoPesquisa()},dom:"frtBpi",buttons:[{extend:"excelHtml5",text:'<i class="fa fa-file-excel-o"></i> Excel',className:"btn btn-outline-default btn-sm",title:NOME_PROJETO+" - CEI - Operações",titleAttr:"Excel",exportOptions:{columns:[idxGridData,idxGridTipo,idxGridAtivo,idxGridQuant,idxGridPreco,idxGridTotal,idxGridCorret,idxGridSitDescr]},customizeData:function(r){for(var i=0;i<r.body.length;i++)for(var a=0;a<r.body[i].length;a++)a==idxGridQuant&&(r.body[i][a]="‌"+r.body[i][a])}},{extend:"csvHtml5",charset:"UTF-8",fieldSeparator:";",titleAttr:"CSV",text:'<i class="fa fa-file-o"></i> CSV',className:"btn btn-outline-default btn-sm",title:NOME_PROJETO+" - CEI - Operações",bom:!0,exportOptions:{columns:[idxGridData,idxGridTipo,idxGridAtivo,idxGridQuant,idxGridPreco,idxGridTotal,idxGridCorret,idxGridSitDescr]}},{extend:"pdfHtml5",text:'<i class="fa fa-file-pdf-o"></i> PDF',className:"btn btn-default btn-sm",titleAttr:"PDF",title:NOME_PROJETO+" - CEI - Operações",pageSize:"A3",alignment:"center",exportOptions:{columns:[idxGridData,idxGridTipo,idxGridAtivo,idxGridQuant,idxGridPreco,idxGridTotal,idxGridCorret,idxGridSitDescr]},footer:!0,customize:function(r){r.defaultStyle.fontSize=12,r.styles.tableHeader.fontSize=14}},{extend:"print",text:'<i class="fa fa-print"></i> Imprimir',title:NOME_PROJETO+" - CEI - Operações",titleAttr:"Imprimir",className:"btn btn-default btn-sm",exportOptions:{columns:[idxGridData,idxGridTipo,idxGridAtivo,idxGridQuant,idxGridPreco,idxGridTotal,idxGridCorret,idxGridSitDescr]}}],bPaginate:!1,bLengthChange:!1,bFilter:!1,searchable:!1,bAutoWidth:!1,bInfo:!0,bSearchable:!1,bSortable:!1,orderable:!1,bOrderable:!1,bOrdering:!1});$(document).ajaxError(function(i,a,t,e){fLimparSomenteGrid(r),finalizarAnimacaoPesquisa()}),a(!0)}).then(r=>{}).catch(r=>{fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(i){fLimparSomenteGrid(r),finalizarAnimacaoPesquisa(),null!=i.description&&fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fCarregarGrid(r){try{promise=new Promise((i,a)=>{if(finalizarAnimacaoPesquisa(),iniciarAnimacaoPesquisar(),fLimparAreaAlertaPrinc(),$("#Grid").length<=0)i(!0);else{$("#Grid").dataTable().fnClearTable(),$("#Grid").dataTable({bDestroy:!0}).fnDestroy(),$("#ckTodos").prop("checked",!1);var t=tirarFormacataoData($("#txtCeiDataIni").val().trim()),e=tirarFormacataoData($("#txtCeiDataFim").val().trim()),d=$("#selCeiAtivo").val();$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:r+"cei/grid",data:{DataIni:t,DataFim:e,CodAtivo:d},success:function(i){var a=i.data.Resultado,t=i.data.Mensagem,e=i.data.Lista;return"NSESSAO"==a?($(location).attr("href",r+"/login"),!1):"NOK"==a?(finalizarAnimacaoPesquisa(),fLimparSomenteGrid(r),void fCriarAlertaPrinc(TP_ALERTA_AVISO,t)):"FALHA"==a?(finalizarAnimacaoPesquisa(),fLimparSomenteGrid(r),void fCriarAlertaPrinc(TP_ALERTA_ERRO,t)):"OK"!=a?(finalizarAnimacaoPesquisa(),fLimparSomenteGrid(r),void fCriarAlertaPrinc(TP_ALERTA_ERRO,t)):void fMontarGrid(r,e)},error:function(i,a,t){return finalizarAnimacaoPesquisa(),fLimparSomenteGrid(r),fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO),!1}}),i(!0)}}).then(r=>{}).catch(r=>{finalizarAnimacaoPesquisa(),fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(i){finalizarAnimacaoPesquisa(),fLimparSomenteGrid(r),null!=i.description&&fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fProcurarAlterarLinhaGridOper(r,i,a){try{promise=new Promise((t,e)=>{$("#Grid > tbody > tr").each(function(t,e){i.indexOf(t.toString())>=0&&fAlterarLinhaGridOper(r,$(this),t,a)}),PagCeiSitLanc="",PagCeiLstIdxTr=[],PagCeiLstIdOper=[],PagCeiLstIdProv=[],t(!0)}).then(r=>{}).catch(r=>{finalizarAnimacaoSalvarCei(),fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(r){return finalizarAnimacaoSalvarCei(),void fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fAlterarLinhaGridOper(r,i,a,t){try{promise=new Promise((r,e)=>{$(i).find("td:eq("+idxGridSel+")").text(""),$("#BtnAddOper-"+a).removeClass("btn-success"),$("#BtnAddOper-"+a).addClass("btn-muted"),$("#BtnAddOper-"+a).addClass("disabled"),$("#BtnConfOper-"+a).removeClass("btn-info"),$("#BtnConfOper-"+a).addClass("btn-muted"),$("#BtnConfOper-"+a).addClass("disabled"),$(i).children("td").removeClass("text-muted"),"C"==t&&($(i).find("td:eq("+idxGridSitDescr+")").text("Conferida"),$(i).children("td").addClass("text-info")),"L"==t&&($(i).find("td:eq("+idxGridSitDescr+")").text("Lançada"),$(i).children("td").addClass("text-success")),r(!0)}).then(r=>{}).catch(r=>{finalizarAnimacaoSalvarCei(),fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(r){return finalizarAnimacaoSalvarCei(),void fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fAlterarSitOperCei(r,i,a,t,e,d=!0){try{promise=new Promise((o,n)=>{""!=a&&(i=[]).push(a),i.length<=0?fCriarAlertaPrinc(TP_ALERTA_AVISO,"Id. não informado."):""!=t?($.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:r+"cei/alterarlistasituacao",data:{LstIdOper:i,IdSit:t},success:function(i){var a=i.data.Resultado,o=i.data.Mensagem;if("NSESSAO"==a)return $(location).attr("href",r+"/login"),!1;"NOK"!=a?"OK"==a?d&&(lstIdxTr=[],lstIdxTr.push(e.toString()),fProcurarAlterarLinhaGridOper(r,lstIdxTr,t)):fCriarAlertaPrinc(TP_ALERTA_ERRO,o):fCriarAlertaPrinc(TP_ALERTA_AVISO,o)},error:function(r,i,a){fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}),o(!0)):fCriarAlertaPrinc(TP_ALERTA_AVISO,"Situação não informada.")}).then(r=>{}).catch(r=>{fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(r){return void fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fAbrirModalDetalheOperLocal(r,i,a,t,e,d,o,n,s,l){PagCeiSitLanc="L",(PagCeiLstIdxTr=[]).push(s.toString()),PagCeiLstIdProv=[],(PagCeiLstIdOper=[]).push(l),fAbrirModalDetalheOper(r,i,a,t,e,d,o,n)}async function fConferirLancOper(r){try{promise=new Promise((i,a)=>{var t=!1,e=[];$("#Grid > tbody > tr").each(function(i,a){var d=$(this).find("td:eq("+idxGridSel+")").find("input:checked");if($(d).length>0){t=!0;var o=$(d).attr("id").replace("ckSelOper-","");e.push(o),fAlterarLinhaGridOper(r,$(this),i,"C")}}),t?(fAlterarSitOperCei(r,e,"","C",0,!1),$("#ckTodos").prop("checked",!1)):fCriarAlertaPrinc(TP_ALERTA_AVISO,"Nenhum item selecionado!"),i(!0)}).then(r=>{}).catch(r=>{fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(r){return void fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fAgruparLancOper(r){try{promise=new Promise((i,a)=>{var t=!1,e=!0,d="",o="",n="",s=0,l=0,c=0;PagCeiSitLanc="L",PagCeiLstIdxTr=[],PagCeiLstIdOper=[],PagCeiLstIdProv=[],$("#Grid > tbody > tr").each(function(r,i){var a=$(this).find("td:eq("+idxGridSel+")").find("input:checked");if($(a).length>0){t=!0;var l=$(a).attr("id").replace("ckSelOper-",""),P=colcarFormacataoDataXMLPadrao($(this).find("td:eq("+idxGridData+")").text().trim()),A=$(this).find("td:eq("+idxGridTipo+")").text().trim().substr(0,1),f=$(this).find("td:eq("+idxGridAtivo+")").text().trim(),v=$(this).find("td:eq("+idxGridQuant+")").text().trim(),u=$(this).find("td:eq("+idxGridTotal+")").text().trim();if(""==d&&(d=P),""==o&&(o=A),""==n&&(n=f),d!=P&&(e=!1),o!=A&&(e=!1),n!=f&&(e=!1),!e)return!1;PagCeiLstIdxTr.push(r.toString()),PagCeiLstIdOper.push(l),s+=parseInt(GetValorInteiro(v.replace(".","").replace(",",""))),c+=parseFloat(GetValorDecimal(u.replace("R$","")))}}),t?e?($("#ckTodos").prop("checked",!1),s>0&&c>0&&(l=c/s),fAbrirModalDetalheOper(r,"","Novo",o,n,s.toString(),fMascaraValor(l),d)):(PagCeiSitLanc="",PagCeiLstIdxTr=[],PagCeiLstIdOper=[],PagCeiLstIdProv=[],fCriarAlertaPrinc(TP_ALERTA_AVISO,"Para Agrupar os Lançamentos em uma única Operação, somente é permitido a mesma Data, Tipo e Ativo...")):(PagCeiSitLanc="",PagCeiLstIdxTr=[],PagCeiLstIdOper=[],PagCeiLstIdProv=[],fCriarAlertaPrinc(TP_ALERTA_AVISO,"Nenhum item selecionado!")),i(!0)}).then(r=>{}).catch(r=>{fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(r){return void fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function iniciarAnimacaoPesquisarProv(){$("#iProvRefresh").addClass("fa-spin"),$("#btnCeiProvPesquisar").addClass("disabled")}function finalizarAnimacaoPesquisaProv(){$("#iProvRefresh").removeClass("fa-spin"),$("#btnCeiProvPesquisar").removeClass("disabled")}function fLimparGridProv(r){$("#selCeiProvAtivo").val(""),$("#txtCeiProvDataIni").val(fDataPrimeira()),$("#txtCeiProvDataFim").val(""),fLimparSomenteGridProv(r)}function fLimparSomenteGridProv(r){try{if(finalizarAnimacaoPesquisaProv(),$("th").addClass("text-center"),$("#GridProv").length<=0)return;$("#GridProv").dataTable().fnClearTable(),$("#GridProv").dataTable({bDestroy:!0}).fnDestroy(),$("#GridProv").DataTable({data:[],oLanguage:fTraduzirGrid(),aoColumns:[{bSortable:!1,sWidth:widthGridProvSel,targets:idxGridProvSel},{bSortable:!1,sWidth:widthGridProvDataPagto,targets:idxGridProvDataPagto},{bSortable:!1,sWidth:widthGridProvTipo,targets:idxGridProvTipo},{bSortable:!1,sWidth:widthGridProvAtivo,targets:idxGridProvAtivo},{bSortable:!1,sWidth:widthGridProvQuant,targets:idxGridProvQuant},{bSortable:!1,sWidth:widthGridProvTotBruto,targets:idxGridProvTotBruto},{bSortable:!1,sWidth:widthGridProvTotLiquido,targets:idxGridProvTotLiquido},{bSortable:!1,sWidth:widthGridProvCorret,targets:idxGridProvCorret},{bSortable:!1,sWidth:widthGridProvSitDescr,targets:idxGridProvSitDescr},{visible:!1,targets:idxGridProvIdProv},{visible:!1,targets:idxGridProvIdSit},{bSortable:!1,sWidth:widthGridProvAcao,targets:idxGridProvAcao}],bLengthChange:!1,bFilter:!1,searchable:!0,orderable:!1,bAutoWidth:!1})}catch(r){fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fMontarGridProv(r,i){try{promise=new Promise((a,t)=>{var e=-1;$("#GridProv").DataTable({processing:!0,serverSide:!1,oLanguage:fTraduzirGrid(),data:i,aoColumns:[{bSortable:!1,sWidth:widthGridProvSel,targets:idxGridProvSel,render:function(r,i,a){if("display"==i)var t=a[idxGridProvIdSit];return"I"==t?"<input class='check-cei-prov' type='checkbox' id='ckSelProv-"+a[idxGridProvIdProv]+"'/>":r}},{bSortable:!1,sWidth:widthGridProvDataPagto,targets:idxGridProvDataPagto,render:function(r,i,a){return"display"==i?colcarFormacataoData(a[idxGridProvDataPagto]):r}},{bSortable:!1,sWidth:widthGridProvTipo,targets:idxGridProvTipo,render:function(r,i,a){return"display"==i?a[idxGridProvTipo]:r}},{bSortable:!1,sWidth:widthGridProvAtivo,targets:idxGridProvAtivo,render:function(r,i,a){return"display"==i?a[idxGridProvAtivo]:r}},{bSortable:!1,sWidth:widthGridProvQuant,targets:idxGridProvQuant,render:function(r,i,a){return"display"==i?colcarFormacataoInteiro(a[idxGridProvQuant]):r}},{bSortable:!1,sWidth:widthGridProvTotBruto,targets:idxGridProvTotBruto,render:function(r,i,a){return"display"==i?"R$ "+a[idxGridProvTotBruto]:r}},{bSortable:!1,sWidth:widthGridProvTotLiquido,targets:idxGridProvTotLiquido,render:function(r,i,a){return"display"==i?"R$ "+a[idxGridProvTotLiquido]:r}},{bSortable:!1,sWidth:widthGridProvCorret,targets:idxGridProvCorret,render:function(r,i,a){return"display"==i?a[idxGridProvCorret]:r}},{bSortable:!1,sWidth:widthGridProvSitDescr,targets:idxGridProvSitDescr,render:function(r,i,a){return"display"==i?a[idxGridProvSitDescr]:r}},{visible:!1,targets:idxGridProvIdProv,render:function(r,i,a){return"display"==i?a[idxGridProvIdProv]:r}},{visible:!1,targets:idxGridProvIdSit,render:function(r,i,a){return"display"==i?a[idxGridProvIdSit]:r}},{bSortable:!1,sWidth:widthGridProvAcao,targets:idxGridProvAcao,render:function(i,a,t){var d="",o="",n="",s="";if("display"==a){e+=1;var l=colcarFormacataoDataXML(t[idxGridProvDataPagto]),c=t[idxGridProvTipo].toUpperCase().substring(0,1),P=t[idxGridProvAtivo],A=parseFloat(GetValorInteiro(t[idxGridProvQuant])),f=parseFloat(GetValorDecimal(t[idxGridProvTotBruto])),v=(parseFloat(GetValorDecimal(t[idxGridProvTotLiquido])),0),u=t[idxGridProvIdProv],G=t[idxGridProvIdSit];A>0&&f>0&&(v=f/A),n="",s="success","L"!=G&&"C"!=G||(n=" disabled",s="muted"),d+='<div class="btn-group btn-group-sm" role="group" aria-label="Basic example">',d+='<a id="BtnAddProv-'+e+'" class="btn btn-sm btn-'+s+" btn-icon btn-icon-mini btn-round btn-simple"+n+'"'+n+' style="font-size:0.5rem; " title="Adicionar Provento Ativo '+P+'" href="javascript:void(0);" onclick="fAbrirModalDetalheRendCalendLocal( \''+r+"', '"+c+"', '"+P+"', '', '"+l+"', '"+fMascaraValorMaior(v)+"', 'Novo', '"+A+"', '"+e+"', '"+u+"' );\">",d+='   <i class="fa fa-plus-square fa-lg" aria-hidden="true"></i> ',d+="</a>",n="",s="info","L"!=G&&"C"!=G||(n=" disabled",s="muted"),o+='<a id="BtnConfProv-'+e+'" class="btn btn-sm btn-'+s+" btn-icon btn-icon-mini btn-round btn-simple"+n+'"'+n+' style="font-size:0.5rem;" title="Marcar como Conferido Provento Ativo '+P+'" href="javascript:void(0);" onclick="fAlterarSitProvCei( \''+r+"', '', '"+u+"', 'C', '"+e+"' );\">",o+='   <i class="fa fa-check fa-lg" aria-hidden="true"></i> ',o+="</a>",o+="</div>"}return d+"&nbsp;"+o}}],createdRow:function(r,i,a){var t=i[idxGridProvIdSit];$("td",r).addClass("text-center"),"I"==t?$("td",r).addClass("text-dark"):"L"==t?$("td",r).addClass("text-success"):"C"==t&&$("td",r).addClass("text-primary")},initComplete:function(r,i){finalizarAnimacaoPesquisaProv()},dom:"frtBpi",buttons:[{extend:"excelHtml5",text:'<i class="fa fa-file-excel-o"></i> Excel',className:"btn btn-outline-default btn-sm",title:NOME_PROJETO+" - CEI - Proventos",titleAttr:"Excel",exportOptions:{columns:[idxGridProvDataPagto,idxGridProvTipo,idxGridProvAtivo,idxGridProvQuant,idxGridProvTotLiquido,idxGridProvTotBruto,idxGridProvCorret,idxGridProvSitDescr]},customizeData:function(r){for(var i=0;i<r.body.length;i++)for(var a=0;a<r.body[i].length;a++)a==idxGridProvQuant&&(r.body[i][a]="‌"+r.body[i][a])}},{extend:"csvHtml5",charset:"UTF-8",fieldSeparator:";",titleAttr:"CSV",text:'<i class="fa fa-file-o"></i> CSV',className:"btn btn-outline-default btn-sm",title:NOME_PROJETO+" - CEI - Proventos",bom:!0,exportOptions:{columns:[idxGridProvDataPagto,idxGridProvTipo,idxGridProvAtivo,idxGridProvQuant,idxGridProvTotLiquido,idxGridProvTotBruto,idxGridProvCorret,idxGridProvSitDescr]}},{extend:"pdfHtml5",text:'<i class="fa fa-file-pdf-o"></i> PDF',className:"btn btn-default btn-sm",titleAttr:"PDF",title:NOME_PROJETO+" - CEI - Proventos",pageSize:"A3",alignment:"center",exportOptions:{columns:[idxGridProvDataPagto,idxGridProvTipo,idxGridProvAtivo,idxGridProvQuant,idxGridProvTotLiquido,idxGridProvTotBruto,idxGridProvCorret,idxGridProvSitDescr]},footer:!0,customize:function(r){r.defaultStyle.fontSize=12,r.styles.tableHeader.fontSize=14}},{extend:"print",text:'<i class="fa fa-print"></i> Imprimir',title:NOME_PROJETO+" - CEI - Proventos",titleAttr:"Imprimir",className:"btn btn-default btn-sm",exportOptions:{columns:[idxGridProvDataPagto,idxGridProvTipo,idxGridProvAtivo,idxGridProvQuant,idxGridProvTotLiquido,idxGridProvTotBruto,idxGridProvCorret,idxGridProvSitDescr]}}],bPaginate:!1,bLengthChange:!1,bFilter:!1,searchable:!0,orderable:!1,bAutoWidth:!1,bInfo:!0,bSearchable:!1,bOrderable:!1,bSortable:!0,bOrdering:!1});$(document).ajaxError(function(i,a,t,e){fLimparSomenteGrid(r),finalizarAnimacaoPesquisaProv()}),a(!0)}).then(r=>{}).catch(r=>{fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(i){fLimparSomenteGrid(r),finalizarAnimacaoPesquisaProv(),null!=i.description&&fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fCarregarGridProv(r){try{promise=new Promise((i,a)=>{if(finalizarAnimacaoPesquisaProv(),iniciarAnimacaoPesquisarProv(),fLimparAreaAlertaPrinc(),$("#GridProv").length<=0)i(!0);else{$("#GridProv").dataTable().fnClearTable(),$("#GridProv").dataTable({bDestroy:!0}).fnDestroy(),$("#ckTodosProv").prop("checked",!1);var t=tirarFormacataoData($("#txtCeiProvDataIni").val().trim()),e=tirarFormacataoData($("#txtCeiProvDataFim").val().trim()),d=$("#selCeiProvAtivo").val();$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:r+"cei/gridprov",data:{DataIni:t,DataFim:e,CodAtivo:d},success:function(i){var a=i.data.Resultado,t=i.data.Mensagem,e=i.data.Lista;return"NSESSAO"==a?($(location).attr("href",r+"/login"),!1):"NOK"==a?(finalizarAnimacaoPesquisaProv(),fLimparSomenteGridProv(r),void fCriarAlertaPrinc(TP_ALERTA_AVISO,t)):"FALHA"==a?(finalizarAnimacaoPesquisaProv(),fLimparSomenteGridProv(r),void fCriarAlertaPrinc(TP_ALERTA_ERRO,t)):"OK"!=a?(finalizarAnimacaoPesquisaProv(),fLimparSomenteGridProv(r),void fCriarAlertaPrinc(TP_ALERTA_ERRO,t)):void fMontarGridProv(r,e)},error:function(i,a,t){return finalizarAnimacaoPesquisaProv(),fLimparSomenteGridProv(r),fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO),!1}}),i(!0)}}).then(r=>{}).catch(r=>{finalizarAnimacaoPesquisaProv(),fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(i){finalizarAnimacaoPesquisaProv(),fLimparSomenteGridProv(r),null!=i.description&&fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fProcurarAlterarLinhaGridProv(r,i,a){try{promise=new Promise((t,e)=>{$("#GridProv > tbody > tr").each(function(t,e){i.indexOf(t.toString())>=0&&fAlterarLinhaGridProv(r,$(this),t,a)}),PagCeiSitLanc="",PagCeiLstIdxTr=[],PagCeiLstIdOper=[],PagCeiLstIdProv=[],t(!0)}).then(r=>{}).catch(r=>{finalizarAnimacaoSalvarCei(),fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(r){return finalizarAnimacaoSalvarCei(),void fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fAlterarLinhaGridProv(r,i,a,t){try{promise=new Promise((r,e)=>{$(i).find("td:eq("+idxGridProvSel+")").text(""),$("#BtnAddProv-"+a).removeClass("btn-success"),$("#BtnAddProv-"+a).addClass("btn-muted"),$("#BtnAddProv-"+a).addClass("disabled"),$("#BtnConfProv-"+a).removeClass("btn-info"),$("#BtnConfProv-"+a).addClass("btn-muted"),$("#BtnConfProv-"+a).addClass("disabled"),$(i).children("td").removeClass("text-muted"),"C"==t&&($(i).find("td:eq("+idxGridProvSitDescr+")").text("Conferido"),$(i).children("td").addClass("text-info")),"L"==t&&($(i).find("td:eq("+idxGridProvSitDescr+")").text("Lançado"),$(i).children("td").addClass("text-success")),r(!0)}).then(r=>{}).catch(r=>{finalizarAnimacaoSalvarCei(),fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(r){return finalizarAnimacaoSalvarCei(),void fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fAlterarSitProvCei(r,i,a,t,e,d=!0){try{promise=new Promise((o,n)=>{""!=a&&(i=[]).push(a),i.length<=0?fCriarAlertaPrinc(TP_ALERTA_AVISO,"Id. não informado!"):""!=t?($.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:r+"cei/alterarlistasituacaoprov",data:{LstIdProv:i,IdSit:t},success:function(i){var a=i.data.Resultado,o=i.data.Mensagem;if("NSESSAO"==a)return $(location).attr("href",r+"/login"),!1;"NOK"!=a?"OK"==a?d&&(lstIdxTr=[],lstIdxTr.push(e.toString()),fProcurarAlterarLinhaGridProv(r,lstIdxTr,t)):fCriarAlertaPrinc(TP_ALERTA_ERRO,o):fCriarAlertaPrinc(TP_ALERTA_AVISO,o)},error:function(r,i,a){fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}),o(!0)):fCriarAlertaPrinc(TP_ALERTA_AVISO,"Situação não informada!")}).then(r=>{}).catch(r=>{fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(r){return void fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fAbrirModalDetalheRendCalendLocal(r,i,a,t,e,d,o,n,s,l){PagCeiSitLanc="L",(PagCeiLstIdxTr=[]).push(s.toString()),PagCeiLstIdOper=[],(PagCeiLstIdProv=[]).push(l),fAbrirModalDetalheRendCalend(r,i,a,t,e,d,o,n.toString())}async function fConferirLancProv(r){try{promise=new Promise((i,a)=>{var t=!1,e=[];$("#GridProv > tbody > tr").each(function(i,a){var d=$(this).find("td:eq("+idxGridProvSel+")").find("input:checked");if($(d).length>0){t=!0;var o=$(d).attr("id").replace("ckSelProv-","");e.push(o),fAlterarLinhaGridProv(r,$(this),i,"C")}}),t?(fAlterarSitProvCei(r,e,"","C",0,!1),$("#ckTodosProv").prop("checked",!1)):fCriarAlertaPrinc(TP_ALERTA_AVISO,"Nenhum item selecionado!"),i(!0)}).then(r=>{}).catch(r=>{fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(r){return void fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fAgruparLancProv(r){try{promise=new Promise((i,a)=>{var t=!1,e=!0,d="",o="",n="",s=0,l=0,c=0;PagCeiSitLanc="L",PagCeiLstIdxTr=[],PagCeiLstIdOper=[],PagCeiLstIdProv=[],$("#GridProv > tbody > tr").each(function(r,i){var a=$(this).find("td:eq("+idxGridProvSel+")").find("input:checked");if($(a).length>0){t=!0;var l=$(a).attr("id").replace("ckSelProv-",""),P=colcarFormacataoDataXMLPadrao($(this).find("td:eq("+idxGridProvDataPagto+")").text().trim()),A=$(this).find("td:eq("+idxGridProvTipo+")").text().trim().substr(0,1),f=$(this).find("td:eq("+idxGridProvAtivo+")").text().trim(),v=$(this).find("td:eq("+idxGridProvQuant+")").text().trim(),u=$(this).find("td:eq("+idxGridProvTotLiquido+")").text().trim(),G=$(this).find("td:eq("+idxGridProvTotBruto+")").text().trim();if(""==d&&(d=P),""==o&&(o=A),""==n&&(n=f),d!=P&&(e=!1),o!=A&&(e=!1),n!=f&&(e=!1),!e)return!1;PagCeiLstIdxTr.push(r.toString()),PagCeiLstIdProv.push(l),s+=parseInt(GetValorInteiro(v.replace(".","").replace(",",""))),c+=parseFloat(GetValorDecimal(u.replace("R$",""))),parseFloat(GetValorDecimal(G.replace("R$","")))}}),t?e?($("#ckTodosProv").prop("checked",!1),s>0&&c>0&&(l=c/s),fAbrirModalDetalheRendCalend(r,o,n,"",d,fMascaraValorMaior(l),"Novo",s.toString())):(PagCeiSitLanc="",PagCeiLstIdxTr=[],PagCeiLstIdOper=[],PagCeiLstIdProv=[],fCriarAlertaPrinc(TP_ALERTA_AVISO,"Para Agrupar os Lançamentos em um único Provento, somente é permitido a mensam Data, Tipo e Ativo...")):(PagCeiSitLanc="",PagCeiLstIdxTr=[],PagCeiLstIdOper=[],PagCeiLstIdProv=[],fCriarAlertaPrinc(TP_ALERTA_AVISO,"Nenhum item selecionado!")),i(!0)}).then(r=>{}).catch(r=>{fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(r){return void fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}$(document).ready(function(){$("#MnPrincCei").addClass("active open"),fLimparAreaAlertaPrinc(),fLimparAreaAlertaModalCad(),fLimparAreaAlertaModalExc(),fLimparAreaAlerta("AlertaModalDadosCei"),idxGridSel=0,idxGridData=1,idxGridTipo=2,idxGridAtivo=3,idxGridQuant=4,idxGridPreco=5,idxGridTotal=6,idxGridCorret=7,idxGridSitDescr=8,idxGridIdOper=9,idxGridIdSit=10,idxGridAcao=11,widthGridSel="15px",widthGridData="40px",widthGridTipo="50px",widthGridAtivo="40px",widthGridQuant="50px",widthGridPreco="50px",widthGridTotal="70px",widthGridCorret="90px",widthGridSitDescr="50px",widthGridIdOper="",widthGridIdSit="",widthGridAcao="30px",idxGridProvSel=0,idxGridProvDataPagto=1,idxGridProvTipo=2,idxGridProvAtivo=3,idxGridProvQuant=4,idxGridProvTotBruto=5,idxGridProvTotLiquido=6,idxGridProvCorret=7,idxGridProvSitDescr=8,idxGridProvIdProv=9,idxGridProvIdSit=10,idxGridProvAcao=11,widthGridProvSel="15px",widthGridProvDataPagto="40px",widthGridProvTipo="50px",widthGridProvAtivo="40px",widthGridProvQuant="50px",widthGridProvTotBruto="70px",widthGridProvTotLiquido="70px",widthGridProvCorret="90px",widthGridProvSitDescr="50px",widthGridProvIdProv="",widthGridProvIdSit="",widthGridProvAcao="30px",$("#ckTodos").click(function(){var r=$(this).is(":checked");$(".check-cei-oper").each(function(){$(this).prop("checked",r)})}),$("#ckTodosProv").click(function(){var r=$(this).is(":checked");$(".check-cei-prov").each(function(){$(this).prop("checked",r)})}),$("#FormOper input[type=text]").bind("keyup change",function(){fCalcularPrecoTotal(),fCalcularOperacao()}),$("#txtDivQuant").bind("keyup change",function(){fCalcularDividendo()}),$("#txtDivPreco").bind("keyup change",function(){fCalcularDividendo()}),$("#selDivTipo").bind("change",function(){fMostrarCalcVlrLiq(),fMostrarValorBruto(),fCalcularDividendo()}),$("#txtDivCalcVlrLiq").bind("change",function(){fMostrarValorBruto(),fCalcularDividendo()}),$("#txtDivPrecoBruto").unbind("keyup"),$("#txtDivPrecoBruto").unbind("change")});