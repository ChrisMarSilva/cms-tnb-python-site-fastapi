async function fLimparGridBalancePercent(t){promise=new Promise((t,a)=>{fLimparAreaAlerta("AreaAlertaPrincAnaliseBalance"),$("#DivBalancePercentGrid").html("");fAtualizarDadosTituloBalancePercent(0,0,0,0,0,0,0,0),t(!0)}).then(t=>{}).catch(t=>{})}async function fAtualizarDadosTituloBalancePercent(t,a,r,e,l,o,d,c){promise=new Promise((s,i)=>{$("#TxtBalancePercent_TotAtual").html("R$ "+fMascaraValor(t)),$("#TxtBalancePercent_TotAjuste").html("R$ "+fMascaraValor(a));var n=0;t>0&&r>0&&(n=r/t*100),$("#TxtBalancePercent_TotAtualAcao").html("R$ "+fMascaraValor(r)+" ("+fMascaraValor(n)+"%)");var b=0;a>0&&e>0&&(b=e/a*100),$("#TxtBalancePercent_TotAjusteAcao").html("R$ "+fMascaraValor(e)+" ("+fMascaraValor(b)+"%)");var x=0;t>0&&l>0&&(x=l/t*100),$("#TxtBalancePercent_TotAtualFII").html("R$ "+fMascaraValor(l)+" ("+fMascaraValor(x)+"%)");var p=0;a>0&&o>0&&(p=o/a*100),$("#TxtBalancePercent_TotAjusteFII").html("R$ "+fMascaraValor(o)+" ("+fMascaraValor(p)+"%)");var f=0;t>0&&d>0&&(f=d/t*100),$("#TxtBalancePercent_TotAtualETF").html("R$ "+fMascaraValor(d)+" ("+fMascaraValor(f)+"%)");var h=0;a>0&&c>0&&(h=c/a*100),$("#TxtBalancePercent_TotAjusteETF").html("R$ "+fMascaraValor(c)+" ("+fMascaraValor(h)+"%)"),s(!0)}).then(t=>{}).catch(t=>{})}function iniciarAnimacaoPesquisarBalancePercent(){$("#txtFiltroBalanceNotaPercent").attr("disabled","disabled"),fDefinirPadraoSelect("txtFiltroBalanceNotaPercent")}function finalizarAnimacaoPesquisaBalancePercent(){$("#txtFiltroBalanceNotaPercent").removeAttr("disabled"),fDefinirPadraoSelect("txtFiltroBalanceNotaPercent")}async function fCarregarGridBalancePercent(t){try{promise=new Promise((a,r)=>{finalizarAnimacaoPesquisaBalancePercent(),iniciarAnimacaoPesquisarBalancePercent();var e=$("#DivBalancePercentGrid");e.html("");var l=$("#txtFiltroBalanceNotaPercent").val();$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:t+"Analise/gridBalancePercent",data:{IdPortfolio:l},success:function(a){var r=a.data.Resultado,l=a.data.Mensagem,o=a.data.Lista;if("NSESSAO"==r)return $(location).attr("href",t+"/login"),!1;if("NOK"==r)return finalizarAnimacaoPesquisaBalancePercent(),void fCriarAlerta("AreaAlertaPrincAnaliseBalance",TP_ALERTA_AVISO,l);if("FALHA"==r)return finalizarAnimacaoPesquisaBalancePercent(),void fCriarAlerta("AreaAlertaPrincAnaliseBalance",TP_ALERTA_ERRO,l);if("OK"==r){if(o.length>0){var d="",c=0;$.each(o,function(t,a){c+=parseFloat(GetValorDecimal(a[3]))}),o.sort(function(t,a){var r=parseFloat(GetValorDecimal(t[4])),e=parseFloat(GetValorDecimal(a[4]));return r==e?0:r>e?1:-1}),d+='<div class="table-responsive" id="AreaGrid">',d+='<table class="table table-sm table-hover" style="font-size: 12px" border="0" cellspacing="0" width="100%" style="margin: 0px;">',d+="  <thead>",d+='    <tr class="text-center bg-dark text-white" style="font-size: 12px"> ',d+='      <th style="border: 0px; border: 1px solid black;" colspan="3">ATIVO</th>',d+='      <th style="border: 0px;  " bgcolor="#FFFFFF" style="width:10px"> </th>',d+='      <th style="border: 0px; border: 1px solid black;" colspan="3">PORTFÓLIO ATUAL</th>',d+='      <th style="border: 0px;  " bgcolor="#FFFFFF" style="width:10px"> </th>',d+='      <th style="border: 0px; border: 1px solid black;" colspan="3">PORTFÓLIO AJUSTADO</th>',d+='      <th style="border: 0px;  " bgcolor="#FFFFFF" style="width:10px"> </th>',d+='      <th style="border: 0px; border: 1px solid black;" colspan="3">RESULTADO</th>',d+="    </tr>",d+='    <tr class="text-center bg-dark text-white"> ',d+='      <th style="border: 0px; width:5px; border-left: 1px solid black; ">Tipo</th>',d+='      <th style="border: 0px; width:5px; ">Código</th>',d+='      <th style="border: 0px; width:5px; border-right: 1px solid black; ">Preço</th>',d+='      <th style="border: 0px; width:5px;" bgcolor="#FFFFFF" > </th>',d+='      <th style="border: 0px; width:5px; border-left: 1px solid black; "> Quant. </th>',d+='      <th style="border: 0px; width:20px;"> Total</th>',d+='      <th style="border: 0px; width:5px; border-right: 1px solid black; "> % Atual</th>',d+='      <th style="border: 0px; width:5px;" bgcolor="#FFFFFF" > </th>',d+='      <th style="border: 0px; width:15px; border-left: 1px solid black; "> % Definido</th>',d+='      <th style="border: 0px; width:5px;"> Quant. </th>',d+='      <th style="border: 0px; width:20px; border-right: 1px solid black; "> Total</th>',d+='      <th style="border: 0px; width:5px;" bgcolor="#FFFFFF" > </th>',d+='      <th style="border: 0px; width:30px; border-left: 1px solid black; "> Status </th>',d+='      <th style="border: 0px; width:5px;"> Quant. </th>',d+='      <th style="border: 0px; width:20px; border-right: 1px solid black; "> Total </th>',d+="    </tr>",d+="  </thead>",d+="  <tbody>";var s=0;return $.each(o,function(a,r){var e=r[0],l=r[1],o=parseFloat(GetValorDecimal(r[2])),i=parseFloat(GetValorDecimal(r[3])),n=parseFloat(GetValorDecimal(r[4])),b=r[5],x=r[6],p=0;i>0&&c>0&&(p=i/c*100),p>0&&(p=Math.floor(100*p)/100),s!=n&&(s=n,d+='    <tr class="bg-dark"> ',d+='      <td style="border: 0px; border-bottom: 1px solid gray; border-left: 1px solid black;" class="font-weight-bold"> </td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; "class="font-weight-bold"> </td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; border-right: 1px solid black;"> </td>',d+='      <td style="border: 0px; " bgcolor="#FFFFFF"> </td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; border-left: 1px solid black;"> </td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; "> </td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; border-right: 1px solid black;"> </td>',d+='      <td style="border: 0px;  " bgcolor="#FFFFFF"> </td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; border-left: 1px solid black;" align="center"> </td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; "> </td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; border-right: 1px solid black;"> </td>',d+='      <td style="border: 0px; " bgcolor="#FFFFFF"> </td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; border-left: 1px solid black;"> </td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; "> </td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; border-right: 1px solid black;"> </td>',d+="    </tr>"),d+='    <tr class="text-center" id="LinhaPortfBalanc'+e+'"> ',d+='      <td style="border: 0px; border-bottom: 1px solid gray; border-left: 1px solid black;" class="font-weight-bold">'+("ACAO"==x?"AÇÃO":x)+"</td>",d+='      <td style="border: 0px; border-bottom: 1px solid gray; "class="font-weight-bold">'+e+"</td>",d+='      <td style="border: 0px; border-bottom: 1px solid gray; border-right: 1px solid black;">R$ '+fMascaraValor(o)+"</td>",d+='      <td style="border: 0px;  " bgcolor="#FFFFFF"> </td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; border-left: 1px solid black;">'+l+"</td>",d+='      <td style="border: 0px; border-bottom: 1px solid gray; ">R$ '+fMascaraValor(i)+"</td>",d+='      <td style="border: 0px; border-bottom: 1px solid gray; border-right: 1px solid black;">'+fMascaraValor(p)+"%</td>",d+='      <td style="border: 0px;  " bgcolor="#FFFFFF"> </td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; border-left: 1px solid black;" align="center">',d+='          <input type="text" maxlength="6" min="0" max="100" step="0.50" required  id="txtPortfBalancPercent'+e+'"  name="txtPortfBalancPercent'+e+'"  onkeyup="fCalcularBalancePercent(\''+t+'\')"  style="font-size:12px; width:80px; height:25px;"  class="DivPortfBalancPerct form-control text-right"  data-id="'+b+'"  data-codigo="'+e+'"  data-tipoInvest="'+x+'"  data-preco="'+o+'"  data-quant="'+l+'"  data-percent="'+p+'"  data-total="'+i+'"  data-totalinvest="'+c+'"  value="'+fMascaraValor(n)+'" > ',d+="      </td>",d+='      <td style="border: 0px; border-bottom: 1px solid gray; "> <span id="txtPortfBalancQtde'+e+'">0</span> </td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; border-right: 1px solid black;">R$ <span id="txtPortfBalancTot'+e+'">0,00</span></td>',d+='      <td style="border: 0px; " bgcolor="#FFFFFF"> </td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; border-left: 1px solid black;"> <span id="txtPortfBalancStatus'+e+'"> </span></td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; "> <span id="txtPortfBalancQtdeDif'+e+'">0</span> </td>',d+='      <td style="border: 0px; border-bottom: 1px solid gray; border-right: 1px solid black;">R$ <span id="txtPortfBalancDif'+e+'">0,00</span></td>',d+="    </tr>"}),d+='    <tr class="text-center bg-dark text-white"> ',d+='      <td style="border: 0px; border-left: 1px solid black; "> </td>',d+='      <td style="border: 0px; "> </td>',d+='      <td style="border: 0px; border-right: 1px solid black; "> </td>',d+='      <td style="border: 0px; " bgcolor="#FFFFFF" > </td>',d+='      <td style="border: 0px; border-left: 1px solid black;  "> </td>',d+='      <td style="border: 0px; font-size: 11px;" class="font-weight-bold" class="font-weight-bold">R$ '+fMascaraValor(c)+"</td>",d+='      <td style="border: 0px; border-right: 1px solid black; "> </td>',d+='      <td style="border: 0px; " bgcolor="#FFFFFF" > </td>',d+='      <td style="border: 0px; border-left: 1px solid black; " class="font-weight-bold"> <span id="txtPortfBalancPerct" style="font-size: 10px;" >0,00</span>%</td>',d+='      <td style="border: 0px; "> </td>',d+='      <td style="border: 0px; border-right: 1px solid black; font-size: 11px;" class="font-weight-bold">R$ <span id="txtPortfBalancTot">0,00</span></td>',d+='      <td style="border: 0px; " bgcolor="#FFFFFF" > </td>',d+='      <td style="border: 0px; border-left: 1px solid black; "> </td>',d+='      <td style="border: 0px; "> </td>',d+='      <td style="border: 0px; border-right: 1px solid black; "> </td>',d+="    </tr>",d+='    <tr class="text-center bg-dark text-white"> ',d+='      <td style="border: 0px; border-top: 1px solid black; border-left: 1px solid black; " class="font-weight-bold">Tipo</th>',d+='      <td style="border: 0px; border-top: 1px solid black; " class="font-weight-bold">Código</td>',d+='      <td style="border: 0px; border-top: 1px solid black; border-right: 1px solid black; " class="font-weight-bold">Preço</td>',d+='      <td style="border: 0px; " bgcolor="#FFFFFF" > </th>',d+='      <td style="border: 0px; border-top: 1px solid black; border-left: 1px solid black; " class="font-weight-bold"> Quant. </td>',d+='      <td style="border: 0px; border-top: 1px solid black; " class="font-weight-bold"> Total</td>',d+='      <td style="border: 0px; border-top: 1px solid black; border-right: 1px solid black; " class="font-weight-bold"> % Atual</td>',d+='      <td style="border: 0px; " bgcolor="#FFFFFF" > </th>',d+='      <td style="border: 0px; border-top: 1px solid black;  border-left: 1px solid black; " class="font-weight-bold"> % Definido</td>',d+='      <td style="border: 0px; border-top: 1px solid black; " class="font-weight-bold"> Quant. </td>',d+='      <td style="border: 0px; border-top: 1px solid black; border-right: 1px solid black; " class="font-weight-bold"> Total</td>',d+='      <td style="border: 0px; " bgcolor="#FFFFFF" > </th>',d+='      <td style="border: 0px; border-top: 1px solid black; border-left: 1px solid black; " class="font-weight-bold"> Status </td>',d+='      <td style="border: 0px; border-top: 1px solid black; ;" class="font-weight-bold"> Quant. </td>',d+='      <td style="border: 0px; border-top: 1px solid black; border-right: 1px solid black; " class="font-weight-bold"> Total </td>',d+="    </tr>",d+='    <tr class="text-center bg-dark text-white"> ',d+='      <td style="border: 0px; border: 1px solid black;" colspan="3" class="font-weight-bold">ATIVO</td>',d+='      <td style="border: 0px; " bgcolor="#FFFFFF" > </th>',d+='      <td style="border: 0px; border: 1px solid black;" colspan="3" class="font-weight-bold">PORTFÓLIO ATUAL</td>',d+='      <td style="border: 0px; " bgcolor="#FFFFFF" > </th>',d+='      <td style="border: 0px; border: 1px solid black;" colspan="3" class="font-weight-bold">PORTFÓLIO AJUSTADO</td>',d+='      <td style="border: 0px; " bgcolor="#FFFFFF" > </th>',d+='      <td style="border: 0px; border: 1px solid black;" colspan="3" class="font-weight-bold">RESULTADO</td>',d+="    </tr>",d+="  </tbody>",d+="</table>",d+="</div>",e.html(""),e.html(d),fCalcularBalancePercent(t),finalizarAnimacaoPesquisaBalancePercent(),!0}return finalizarAnimacaoPesquisaBalancePercent(),!0}return finalizarAnimacaoPesquisaBalancePercent(),void fCriarAlerta("AreaAlertaPrincAnaliseBalance",TP_ALERTA_ERRO,l)},error:function(t,a,r){finalizarAnimacaoPesquisaBalancePercent(),fCriarAlerta("AreaAlertaPrincAnaliseBalance",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}),a(!0)}).then(t=>{}).catch(t=>{})}catch(t){finalizarAnimacaoPesquisaBalancePercent(),fCriarAlerta("AreaAlertaPrincAnaliseBalance",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fCalcularBalancePercent(t){try{promise=new Promise((t,a)=>{fLimparAreaAlerta("AreaAlertaPrincAnaliseBalance");var r=0,e=0,l=0,o=0,d=0,c=0,s=0,i=0,n=0,b=0;$.each($(".DivPortfBalancPerct"),function(){var t=$(this).data("codigo"),a=$(this).data("tipoinvest"),x=$(this).data("preco"),p=$(this).data("quant"),f=$(this).data("percent"),h=$(this).data("total"),A=$(this).data("totalinvest"),P=parseFloat(GetValorDecimal($("#txtPortfBalancPercent"+t).val())),F=0,y=0,g=0,m=0,B=0,u="NDA";P>0&&A>0&&(F=A/100*P),F>0&&x>0&&(y=Math.floor(F/x)),y>0&&(g=y*x),h>g&&(m=h-g,B=Math.floor(m/x),u="VENDER"),h<g&&(m=g-h,B=Math.floor(m/x),u="COMPRAR"),0!=B&&"0"!=B.toLocaleString()&&f!=P||(y=p,g=h,m=0,B=0,u="NDA"),$("#txtPortfBalancQtde"+t).html(y.toLocaleString()),$("#txtPortfBalancTot"+t).html(fMascaraValor(g)),$("#txtPortfBalancDif"+t).html(fMascaraValor(m)),$("#txtPortfBalancQtdeDif"+t).html(B.toLocaleString()),$("#txtPortfBalancStatus"+t).html(u),$("#txtPortfBalancStatus"+t).removeClass("text-muted"),$("#txtPortfBalancStatus"+t).removeClass("text-success"),$("#txtPortfBalancStatus"+t).removeClass("text-danger"),"NDA"==u&&$("#txtPortfBalancStatus"+t).addClass("text-muted"),"COMPRAR"==u&&$("#txtPortfBalancStatus"+t).addClass("text-success"),"VENDER"==u&&$("#txtPortfBalancStatus"+t).addClass("text-danger"),r+=P,e+=g,l+=h,"ACAO"==a&&(d+=h),"FII"==a&&(s+=h),"ETF"==a&&(n+=h),o+=g,"ACAO"==a&&(c+=g),"FII"==a&&(i+=g),"ETF"==a&&(b+=g)}),$("#txtPortfBalancPerct").html(fMascaraValor(r)),$("#txtPortfBalancTot").html(fMascaraValor(e)),fAtualizarDadosTituloBalancePercent(l,o,d,c,s,i,n,b),t(!0)}).then(t=>{}).catch(t=>{})}catch(t){fCriarAlerta("AreaAlertaPrincAnaliseBalance",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fDividirValoresBalancePercent(t){try{promise=new Promise((a,r)=>{fLimparAreaAlerta("AreaAlertaPrincAnaliseBalance"),qtdeAtv=0,$.each($(".DivPortfBalancPerct"),function(){qtdeAtv+=1}),qtdeAtv>0&&(PercentIdeal=100/qtdeAtv),PercentIdeal>0&&(PercentIdeal=Math.floor(100*PercentIdeal)/100),$.each($(".DivPortfBalancPerct"),function(){var t=$(this).data("codigo");$("#txtPortfBalancPercent"+t).val(fMascaraValor(PercentIdeal))}),fCalcularBalancePercent(t),a(!0)}).then(t=>{}).catch(t=>{})}catch(t){fCriarAlerta("AreaAlertaPrincAnaliseBalance",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fResetarValoresBalancePercent(t){try{promise=new Promise((t,a)=>{fLimparAreaAlerta("AreaAlertaPrincAnaliseBalance");var r=0,e=0,l=0,o=0,d=0,c=0,s=0,i=0,n=0;$.each($(".DivPortfBalancPerct"),function(){var t=$(this).data("codigo"),a=$(this).data("tipoinvest"),b=$(this).data("quant"),x=$(this).data("percent"),p=$(this).data("total");r=$(this).data("totalinvest"),$("#txtPortfBalancPercent"+t).val(fMascaraValor(x)),$("#txtPortfBalancTot"+t).html(fMascaraValor(p)),$("#txtPortfBalancQtde"+t).html(b.toLocaleString()),$("#txtPortfBalancDif"+t).html(fMascaraValor(0)),$("#txtPortfBalancQtdeDif"+t).html((0).toLocaleString()),$("#txtPortfBalancStatus"+t).html("NDA"),$("#txtPortfBalancStatus"+t).removeClass("text-success"),$("#txtPortfBalancStatus"+t).removeClass("text-danger"),$("#txtPortfBalancStatus"+t).addClass("text-muted"),e+=p,"ACAO"==a&&(o+=p),"FII"==a&&(c+=p),"ETF"==a&&(i+=p),l+=p,"ACAO"==a&&(d+=p),"FII"==a&&(s+=p),"ETF"==a&&(n+=p)}),$("#txtPortfBalancPerct").html(fMascaraValor(100)),$("#txtPortfBalancTot").html(fMascaraValor(r)),fAtualizarDadosTituloBalancePercent(e,l,o,d,c,s,i,n),t(!0)}).then(t=>{}).catch(t=>{})}catch(t){fCriarAlerta("AreaAlertaPrincAnaliseBalance",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fLimparValoresBalancePercent(t){try{promise=new Promise((a,r)=>{fLimparAreaAlerta("AreaAlertaPrincAnaliseBalance");$.each($(".DivPortfBalancPerct"),function(){var t=$(this).data("codigo");$("#txtPortfBalancPercent"+t).val(fMascaraValor(0)),$("#txtPortfBalancTot"+t).html(fMascaraValor(0)),$("#txtPortfBalancQtde"+t).html((0).toLocaleString()),$("#txtPortfBalancDif"+t).html(fMascaraValor(0)),$("#txtPortfBalancQtdeDif"+t).html((0).toLocaleString()),$("#txtPortfBalancStatus"+t).html("NDA"),$("#txtPortfBalancStatus"+t).removeClass("text-success"),$("#txtPortfBalancStatus"+t).removeClass("text-danger"),$("#txtPortfBalancStatus"+t).addClass("text-muted")}),$("#txtPortfBalancPerct").html(fMascaraValor(0)),$("#txtPortfBalancTot").html(fMascaraValor(0)),fCalcularBalancePercent(t),a(!0)}).then(t=>{}).catch(t=>{})}catch(t){fCriarAlerta("AreaAlertaPrincAnaliseBalance",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fSalvarValoresBalancePercent(t){try{promise=new Promise((a,r)=>{fLimparAreaAlerta("AreaAlertaPrincAnaliseBalance");var e=[],l=0;return $.each($(".DivPortfBalancPerct"),function(){var t=$(this).data("codigo"),a=$(this).data("tipoinvest"),r=parseFloat(GetValorDecimal($("#txtPortfBalancPercent"+t).val()));l+=r,e.push({TipoInvest:a,CodAtivo:t,Percent:r})}),e.length<=0?(fCriarAlerta("AreaAlertaPrincAnaliseBalance",TP_ALERTA_AVISO,"Sem Dados para Salvar!"),!1):l>100?(fCriarAlerta("AreaAlertaPrincAnaliseBalance",TP_ALERTA_AVISO,"Porcentagem Total maior que 100%."),!1):($.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:t+"Analise/salvarBalancePercent",data:{lista:e},success:function(a){var r=a.data.Resultado,e=a.data.Mensagem;if("NSESSAO"==r)return $(location).attr("href",t+"/login"),!1;"NOK"!=r?"FALHA"!=r&&"OK"==r?(fCarregarGridBalancePercent(t),fCriarAlerta("AreaAlertaPrincAnaliseBalance",TP_ALERTA_SUCESSO,"Dados salvo com sucesso!")):fCriarAlerta("AreaAlertaPrincAnaliseBalance",TP_ALERTA_ERRO,e):fCriarAlerta("AreaAlertaPrincAnaliseBalance",TP_ALERTA_AVISO,e)},error:function(t,a,r){fCriarAlerta("AreaAlertaPrincAnaliseBalance",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}),void a(!0))}).then(t=>{}).catch(t=>{})}catch(t){fCriarAlerta("AreaAlertaPrincAnaliseBalance",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}