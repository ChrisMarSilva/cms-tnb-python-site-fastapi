function iniciarAnimacaoPesquisarAnaliseExtrat(){$("#iRefreshExtrat").addClass("fa-spin"),$("#btnAnaliseExtratPesquisar").addClass("disabled")}function finalizarAnimacaoPesquisaAnaliseExtrat(){$("#iRefreshExtrat").removeClass("fa-spin"),$("#btnAnaliseExtratPesquisar").removeClass("disabled")}function fLimparGridAnaliseExtrat(t){fLimparAreaAlerta("AreaAlertaPrincAnaliseExtrato"),$("#txtFiltroAnaliseExtratDataIni").val(fDataAnoPrimeira()),$("#txtFiltroAnaliseExtratDataFim").val(fDataAnoUltima()),$("#txtFiltroAnaliseExtratAtivo").val(""),fDefinirPadraoSelect("txtFiltroAnaliseExtratAtivo")}async function fCarregarGridAnaliseExtrat(t){try{promise=new Promise((a,r)=>{fLimparAreaAlerta("AreaAlertaPrincAnaliseExtrato"),finalizarAnimacaoPesquisaAnaliseExtrat(),iniciarAnimacaoPesquisarAnaliseExtrat(),$("#DivAnaliseExtrato").html("<br/>\t<br/>\t<br/>\t<br/>\t<br/>\t<br/>\t<br/>\t<br/>\t");var e=tirarFormacataoData($("#txtFiltroAnaliseExtratDataIni").val()),i=tirarFormacataoData($("#txtFiltroAnaliseExtratDataFim").val()),o=$("#txtFiltroAnaliseExtratAtivo").val();$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:t+"Analise/extrato",data:{CodAtivo:o,DataIni:e,DataFim:i},success:function(a){var r=a.data.Resultado,e=a.data.Mensagem,i=a.data.Lista;return"NSESSAO"==r?($(location).attr("href",t+"/login"),!1):"NOK"==r?(finalizarAnimacaoPesquisaAnaliseExtrat(),void fCriarAlerta("AreaAlertaPrincAnaliseExtrato",TP_ALERTA_AVISO,e)):"FALHA"==r?(finalizarAnimacaoPesquisaAnaliseExtrat(),void fCriarAlerta("AreaAlertaPrincAnaliseExtrato",TP_ALERTA_ERRO,e)):"OK"!=r?(finalizarAnimacaoPesquisaAnaliseExtrat(),void fCriarAlerta("AreaAlertaPrincAnaliseExtrato",TP_ALERTA_ERRO,e)):void fMontarGridAnaliseExtrat(t,i)},error:function(t){return fCriarAlerta("AreaAlertaPrincAnaliseExtrato",TP_ALERTA_ERRO,MSG_ALERTA_ERRO),!1}}),a(!0)}).then(t=>{}).catch(t=>{})}catch(t){null!=t.description&&fCriarAlerta("AreaAlertaPrincAnaliseExtrato",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fMontarGridAnaliseExtrat(t,a){try{promise=new Promise((t,r)=>{$("#DivAnaliseExtrato").html("<br/>\t<br/>\t<br/>\t<br/>\t<br/>\t<br/>\t<br/>\t<br/>\t");var e=[];$.each(a,function(t,a){var r=a[0],i=a[1],o=a[2],n=a[3],s=parseFloat(GetValorDecimal(a[4])),l=parseFloat(GetValorDecimal(a[5])),d=parseFloat(GetValorDecimal(a[6])),c={data:r,tipoInvest:a[7],tipo:i,ativo:o,quant:n,preco:s,despesa:l,total:d},h=0,A=0;"Compra"==i&&(h=d),"Venda"==i&&(A=d);var b={codigo:o,totalC:h,totalV:A},f={mes:r.substring(4,6),lancamentos:[c],ativos:[b]},v=r.substring(0,4);adicionarAno(e,{ano:v,meses:[f]},f,c,b)}),montarCardAno(e),finalizarAnimacaoPesquisaAnaliseExtrat(),t(!0)}).then(t=>{}).catch(t=>{})}catch(t){finalizarAnimacaoPesquisaAnaliseExtrat(),null!=t.description&&fCriarAlerta("AreaAlertaPrincAnaliseExtrato",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function adicionarAno(t,a,r,e,i){existeAno(t,a,r,e,i)||t.push(a)}function existeAno(t,a,r,e,i){return!!t.filter(function(t){if(t.ano==a.ano)return adicionarMes(t.meses,r,e,i),!0}).length}function adicionarMes(t,a,r,e){existeMes(t,a,r,e)||t.push(a)}function existeMes(t,a,r,e){return!!t.filter(function(t){if(t.mes==a.mes)return adicionarLancamento(t.lancamentos,r),adicionarAtivo(t.ativos,e),!0}).length}function adicionarLancamento(t,a){t.push(a)}function existeAtivo(t,a){return!!t.filter(function(t){if(t.codigo==a.codigo)return t.totalC+=a.totalC,t.totalV+=a.totalV,!0}).length}function adicionarAtivo(t,a){existeAtivo(t,a)||t.push(a)}async function montarCardAno(t){promise=new Promise((a,r)=>{var e=$("#DivAnaliseExtrato");if(t.length>0){t.reverse();var i="";i+='<div id="Div Accordion">',$.each(t,function(t,a){var r=a.ano,e=0===t,o="DivTitulo"+r,n="DivConteudo"+r;i+='<div class="card border-dark" style="margin-bottom: 10px; ">',i+='  <div class="card-header bg-dark" id="'+o+'" style="padding: 0px; ">',i+='    <button class="btn btn-sm btn-link text-white '+(e?"":"collapsed")+'" data-toggle="collapse" data-target="#'+n+'" aria-expanded="'+(e?"true":"false")+'" aria-controls="'+n+'">Ano: '+r+" </button>",i+="  </div>",i+='  <div id="'+n+'" class="collapse '+(e?"show":"")+'" aria-labelledby="'+o+'" data-parent="#DivAccordion">',i+='    <div class="card-body" style="padding: 10px; " >',i+="    "+montarCardMes(r,e,a.meses),i+="    </div>",i+="  </div>",i+="</div>"}),i+="</div>",e.html(i)}else e.html("<br/>\t<br/>\t<br/>\t<br/>\t<br/>\t<br/>\t<br/>\t<br/>\t");a(!0)}).then(t=>{}).catch(t=>{})}function buscarMes(t,a){return!!t.filter(function(t){if(t.mes==a)return!0}).length}function montarCardMes(t,a,r){var e="",i=!1,o=["01","02","03","04","05","06","07","08","09","10","11","12"],n=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],s=["JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ"];return i=!1,e+='<ul class="nav nav-tabs justify-content-center" id="NavTab'+t+'Header" role="tablist">',$.each(o,function(a,o){var l=0===a,d=buscarMes(r,o),c=!1===i&&(!0===l&&!0===d||!1===l&&!0===d);c&&(i=!0),e+='<li class="nav-item"> <a style="width: 80px;" class="border border-dark text-center font-weight-bold nav-link '+(c?"active":"")+" "+(d?"":"disabled font-line-through font-italic text-danger")+'" '+(d?"":' style="pointer-events: none; cursor: default; " tabindex="-1" aria-disabled="true" ')+' id="Nav'+t+n[a]+'Tab" data-toggle="tab" href="#Nav'+t+n[a]+'" aria-controls="Nav'+t+n[a]+'" aria-selected="'+(c?"true":"false")+'" >'+s[a]+"</a></li>"}),e+="</ul>",i=!1,e+='<div class="tab-content" id="NavTab'+t+'Content">',$.each(o,function(a,o){var s=o,l=0===a,d=buscarMes(r,s),c=!1===i&&(!0===l&&!0===d||!1===l&&!0===d);c&&(i=!0),e+='<div class="tab-pane fade '+(c?"show active":"")+'" id="Nav'+t+n[a]+'" role="tabpanel" aria-labelledby="Nav'+t+n[a]+'Tab">',d&&r.filter(function(t){t.mes==s&&(e+=montarCardResumoMes(t.ativos),e+=montarCardLancMes(t.lancamentos))}),e+="</div>"}),e+="</div>"}function montarCardCarteiraMes(t){return"","<br>",'<h6 class="font-weight-bold">PORTFÓLIO ATUAL</h6>','<div class="table-responsive">','<table class="table table-sm table-hover table-condensed nowrap" border="0" cellspacing="0" width="100%" style="font-size: 12px; margin: 0px;">',"  <thead>",'    <tr class="thead-dark font-weight-bold"> ',"      <th>Tipo</th>","      <th>Ativo</th>","      <th>Quant.</th>","      <th>Preço Médio</th>","      <th>Tot. Invest.</th>","      <th>% Portfólio</th>","      <th></th>","      <th>Quant. Compra/Bônus</th>","      <th>Quant. Venda</th>","      <th>Tot. Compra</th>","      <th>Tot. Venda</th>","      <th>Saldo Mês</th>","    </tr>","  </thead>","  <tbody>",$.each(t,function(t,a){}),"  </tbody>","  <tfoot>","  </tfoot>","</table>","</div>",'<br><h6 class="font-weight-bold">PORTFÓLIO ATUAL</h6><div class="table-responsive"><table class="table table-sm table-hover table-condensed nowrap" border="0" cellspacing="0" width="100%" style="font-size: 12px; margin: 0px;">  <thead>    <tr class="thead-dark font-weight-bold">       <th>Tipo</th>      <th>Ativo</th>      <th>Quant.</th>      <th>Preço Médio</th>      <th>Tot. Invest.</th>      <th>% Portfólio</th>      <th></th>      <th>Quant. Compra/Bônus</th>      <th>Quant. Venda</th>      <th>Tot. Compra</th>      <th>Tot. Venda</th>      <th>Saldo Mês</th>    </tr>  </thead>  <tbody>  </tbody>  <tfoot>  </tfoot></table></div>'}function montarCardResumoMes(t){var a="";a="",a+="<br>",a+='<h6 class="font-weight-bold">RESUMO</h6>',a+='<div class="table-responsive">',a+='<table class="table table-sm table-hover table-condensed nowrap" border="0" cellspacing="0" width="100%" style="font-size: 12px; margin: 0px;">',a+="  <thead>",a+='    <tr class="thead-dark font-weight-bold"> ',a+="      <th>Ativo</th>",a+="      <th>Total Compra</th>",a+="      <th>Total Venda</th>",a+="      <th>Saldo</th>",a+="    </tr>",a+="  </thead>",a+="  <tbody>",t.sort(function(t,a){var r=t.codigo,e=a.codigo;return r==e?0:r>e?1:-1});var r=0,e=0;return $.each(t,function(t,i){var o=i.codigo,n=i.totalC,s=i.totalV;(n>0||s>0)&&(a+='    <tr class="text-center"> ',a+='      <td class="text-dark font-weight-bold">'+o+"</td>",a+="      <td>R$ "+fMascaraValor(n)+"</td>",a+="      <td>R$ "+fMascaraValor(s)+"</td>",a+='      <td class="text-dark font-weight-bold">R$ '+fMascaraValor(n-s)+"</td>",a+="    </tr>"),r+=n,e+=s}),a+="  </tbody>",a+="  <tfoot>",a+='    <tr class="bg-light text-dark font-weight-bold" style="font-size: 13px;"> ',a+="      <td>TOTAL</td>",a+="      <td>R$ "+fMascaraValor(r)+"</td>",a+="      <td>R$ "+fMascaraValor(e)+"</td>",a+="      <td>R$ "+fMascaraValor(r-e)+"</td>",a+="    </tr>",a+="  </tfoot>",a+="</table>",a+="</div>"}function montarCardLancMes(t){var a="";return a="",a+="<br>",a+='<h6 class="font-weight-bold">LANÇAMENTOS</h6>',a+='<div class="table-responsive">',a+='<table class="table table-sm table-hover table-condensed nowrap" border="0" cellspacing="0" width="100%" style="font-size: 12px; margin: 0px;">',a+="  <thead>",a+='    <tr class="thead-dark font-weight-bold"> ',a+="      <th>Data</th>",a+="      <th>Categoria</th>",a+="      <th>Tipo</th>",a+="      <th>Ativo</th>",a+="      <th>Quant.</th>",a+="      <th>Preço</th>",a+="      <th>Despesas</th>",a+="      <th>Total</th>",a+="    </tr>",a+="  </thead>",a+="  <tbody>",t.sort(function(t,a){var r=t.data,e=a.data;return r==e?0:r>e?1:-1}),$.each(t,function(t,r){var e=r.data,i="ACAO"==r.tipoInvest?"AÇÃO":r.tipoInvest,o=r.tipo,n=r.ativo,s=r.quant,l=r.preco,d=r.despesa,c=r.total;a+='    <tr class="text-center"> ',a+='      <td class="text-dark font-weight-bold">'+colcarFormacataoData(e)+"</td>",a+="      <td>"+i+"</td>",a+="      <td>"+o+"</td>",a+='      <td class="text-dark font-weight-bold">'+n+"</td>",a+="      <td>"+colcarFormacataoInteiro(s)+"</td>",a+="      <td>R$ "+fMascaraValor(l)+"</td>",a+="      <td>R$ "+fMascaraValor(d)+"</td>",a+='      <td class="text-dark font-weight-bold">R$ '+fMascaraValor(c)+"</td>",a+="    </tr>"}),a+="  </tbody>",a+="  <tfoot>",a+="  </tfoot>",a+="</table>",a+="</div>",a+="<br>"}