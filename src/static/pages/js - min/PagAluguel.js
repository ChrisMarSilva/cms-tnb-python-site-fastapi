function iniciarAnimacaoPesquisar(){$("#iRefresh").addClass("fa-spin"),$("#btnAlugPesquisar").addClass("disabled"),$("#btnAlugLimpar").addClass("disabled")}function finalizarAnimacaoPesquisa(){$("#iRefresh").removeClass("fa-spin"),$("#btnAlugPesquisar").removeClass("disabled"),$("#btnAlugLimpar").removeClass("disabled")}function fLimparGrid(a){$("#txtFiltroAlugAtivo").val(""),$("#txtFiltroAlugDtIni").val(""),$("#txtFiltroAlugDtFim").val(""),fDefinirPadraoSelect("txtFiltroAlugAtivo"),fLimparSomenteGrid(a)}function fLimparSomenteGrid(a){try{finalizarAnimacaoPesquisa(),$("th").addClass("text-center"),$("#Grid").dataTable().fnClearTable(),$("#Grid").dataTable({bDestroy:!0}).fnDestroy(),$("#Grid").DataTable({data:[],oLanguage:fTraduzirGrid(),aoColumns:[{bSortable:!0,sWidth:"50px",targets:0},{bSortable:!0,sWidth:"50px",targets:1},{bSortable:!0,sWidth:"50px",targets:2},{bSortable:!0,sWidth:"50px",targets:3},{bSortable:!0,sWidth:"50px",targets:4},{visible:!1,targets:5},{bSortable:!0,sWidth:"50px",targets:6}],order:[],bFilter:!1,bInfo:!1,iDisplayLength:100,bLengthChange:!1,bSearchable:!1,bOrderable:!1,bSortable:!1,bAutoWidth:!1,bPaginate:!1,bOrdering:!1})}catch(a){fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fMontarGrid(a,t){try{$("#Grid").DataTable({processing:!0,serverSide:!1,oLanguage:fTraduzirGrid(),data:t,aoColumns:[{bSortable:!0,sWidth:"50px",targets:0,render:function(a,t,r){return"display"==t?colcarFormacataoData(r[0]):a}},{bSortable:!0,sWidth:"50px",targets:1},{bSortable:!0,sWidth:"50px",targets:2,render:function(a,t,r){return"display"==t?"R$ "+r[2]:a}},{bSortable:!0,sWidth:"50px",targets:3,render:function(a,t,r){return"display"==t?"R$ "+r[3]:a}},{bSortable:!0,sWidth:"50px",targets:4,render:function(a,t,r){return"display"==t?"R$ "+r[4]:a}},{visible:!1,targets:5},{bSortable:!0,sWidth:"10px",targets:6,render:function(t,r,l){var i="",e="";return"display"==r&&(IdAlug=l[5],i+='<div class="btn-group btn-group-sm" role="group" aria-label="Basic example">',i+='<a class="btn btn-sm btn-warning btn-icon btn-icon-mini btn-round btn-simple" style="font-size:0.5rem;" title="Alterar" href="javascript:void(0);" onclick="fAbrirModalDetalheAlug( \''+a+"', '"+IdAlug+"', 'Alterar' );\">",i+='   <i class="fa fa-pencil fa-lg" aria-hidden="true"></i> ',i+="</a>",e+='<a class="btn btn-sm btn-danger btn-icon btn-icon-mini btn-round btn-simple" style="font-size:0.5rem;" title="Excluir" href="javascript:void(0);" role="button" aria-pressed="true" onclick="fChamarPagExclusaoCorret( \''+IdAlug+"' );\">",e+='   <i class="fa fa-trash-o fa-lg" aria-hidden="true"></i> ',e+="</a>",e+="</div>"),i+"&nbsp;"+e}}],createdRow:function(a,t,r){$("td",a).addClass("text-center")},initComplete:function(a,t){finalizarAnimacaoPesquisa()},order:[[0,"asc"]],dom:"frtBpi",buttons:[{extend:"excelHtml5",text:'<i class="fa fa-file-excel-o"></i> Excel',className:"btn btn-outline-default btn-sm",title:NOME_PROJETO+" - Aluguel de Ativos",titleAttr:"Excel",exportOptions:{columns:[0,1,2,3,4]}},{extend:"csvHtml5",charset:"UTF-8",fieldSeparator:";",titleAttr:"CSV",text:'<i class="fa fa-file-o"></i> CSV',className:"btn btn-outline-default btn-sm",title:NOME_PROJETO+" - Aluguel de Ativos",bom:!0,exportOptions:{columns:[0,1,2,3,4]}},{extend:"pdfHtml5",text:'<i class="fa fa-file-pdf-o"></i> PDF',className:"btn btn-default btn-sm",titleAttr:"PDF",title:NOME_PROJETO+" - Aluguel de Ativos",pageSize:"A3",alignment:"center",exportOptions:{columns:[0,1,2,3,4]},footer:!0,customize:function(a){a.defaultStyle.fontSize=12,a.styles.tableHeader.fontSize=14}},{extend:"print",text:'<i class="fa fa-print"></i> Imprimir',title:NOME_PROJETO+" - Aluguel de Ativos",titleAttr:"Imprimir",className:"btn btn-default btn-sm",exportOptions:{columns:[0,1,2,3,4]}}],iDisplayLength:100,bLengthChange:!1,bFilter:!1,bInfo:!1,bSearchable:!1,bPaginate:!1,bOrderable:!0,bSortable:!0,bOrdering:!0,searchable:!0,orderable:!0,bAutoWidth:!1}),$(document).ajaxError(function(t,r,l,i){fLimparGrid(a)})}catch(t){fLimparGrid(a),null!=t.description&&fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fCarregarGrid(a){try{fLimparAreaAlertaPrinc(),$("#Grid").dataTable().fnClearTable(),$("#Grid").dataTable({bDestroy:!0}).fnDestroy(),finalizarAnimacaoPesquisa(),iniciarAnimacaoPesquisar();var t=$("#txtFiltroAlugAtivo").val().trim(),r=$("#txtFiltroAlugDtIni").val().trim(),l=$("#txtFiltroAlugDtFim").val().trim();$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:a+"aluguel/grid",data:{CodAtivo:t,DataIni:tirarFormacataoData(r),DataFim:tirarFormacataoData(l)},success:function(t){var r=t.data.Resultado,l=t.data.Mensagem,i=t.data.Lista;return"NSESSAO"==r?($(location).attr("href",a+"/login"),!1):"NOK"==r?(finalizarAnimacaoPesquisa(),fLimparSomenteGrid(a),void fCriarAlertaPrinc(TP_ALERTA_AVISO,l)):"FALHA"==r?(finalizarAnimacaoPesquisa(),fLimparSomenteGrid(a),void fCriarAlertaPrinc(TP_ALERTA_ERRO,l)):"OK"!=r?(finalizarAnimacaoPesquisa(),fLimparSomenteGrid(a),void fCriarAlertaPrinc(TP_ALERTA_ERRO,l)):void fMontarGrid(a,i)},error:function(t,r,l){return fLimparGrid(a),fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO),!1}})}catch(t){fLimparGrid(a),null!=t.description&&fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fCalcularVlrLiquido(){try{$("#txtCadAlugVlrLiquido").val("0,00");var a=GetValorDecimal($("#txtCadAlugVlrBruto").val()),t=GetValorDecimal($("#txtCadAlugVlrIR").val()),r=parseFloat(parseFloat(a)-parseFloat(t));$("#txtCadAlugVlrLiquido").val(fMascaraValor(r))}catch(a){fCriarAlertaModalCad(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fLimparDadosModalAluguel(){fLimparAreaAlertaModalCad(),$("#txtCadAlugId").val(""),$("#txtCadAlugData").val(fDataAtual()),$("#txtCadAlugAtivo").val(""),$("#txtCadAlugVlrBruto").val("0,00"),$("#txtCadAlugVlrIR").val("0,00"),$("#txtCadAlugVlrLiquido").val("0,00"),fDefinirPadraoSelect("txtCadAlugAtivo")}function fAbrirModalDetalheAlug(a,t,r){try{fLimparDadosModalAluguel(),$("#fPopModalDetalheAlugTit").html(""),$("#fPopModalDetalheAlugTit").html(" - "+r),$("#txtCadAlugData").removeAttr("readonly"),$("#txtCadAlugAtivo").removeAttr("readonly"),$("#txtCadAlugAtivo").removeClass("disabled"),$("#txtCadAlugAtivo").removeAttr("disabled"),$("#txtCadAlugVlrBruto").removeAttr("readonly"),$("#txtCadAlugVlrBruto").attr("required","required"),$("#txtCadAlugVlrIR").removeAttr("readonly"),$("#BtnModalDetalheAlugSalvar").show(),"Visualizar"==r&&$("#BtnModalDetalheAlugSalvar").hide(),"Novo"==r&&$("#PopModalDetalheAluguel").modal({backdrop:"static"}),"Alterar"!=r&&"Visualizar"!=r||fCarregarDadosModalDetalheAlug(a,t,r),$("#selDivAtivo").focus()}catch(a){fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fCarregarDadosModalDetalheAlug(a,t,r){try{if(""==t)return void fCriarAlertaPrinc(TP_ALERTA_AVISO,"Id. Aluguel não informado!");$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:a+"aluguel/carregar",data:{IdAlug:t},success:function(t){var l=t.data.Resultado,i=t.data.Mensagem,e=t.data.Dados;if("NSESSAO"==l)return $(location).attr("href",a+"/login"),!1;"NOK"==l?fCriarAlertaPrinc(TP_ALERTA_AVISO,i):"FALHA"==l?fCriarAlertaPrinc(TP_ALERTA_ERRO,i):"OK"==l&&e.Id?($("#txtCadAlugId").val(e.Id),$("#txtCadAlugData").val(e.Data),$("#txtCadAlugAtivo").val(e.CodAtivo),$("#txtCadAlugVlrBruto").val(e.VlrBruto),$("#txtCadAlugVlrIR").val(e.VlrIR),$("#txtCadAlugVlrLiquido").val(e.VlrLiquido),fDefinirPadraoSelect("txtCadAlugAtivo"),"Visualizar"==r&&($("#txtCadAlugData").attr("readonly","readonly"),$("#txtCadAlugData").removeAttr("required"),$("#txtCadAlugAtivo").attr("readonly","readonly"),$("#txtCadAlugAtivo").attr("disabled","disabled"),$("#txtCadAlugAtivo").addClass("disabled"),$("#txtCadAlugVlrBruto").attr("readonly","readonly"),$("#txtCadAlugVlrBruto").removeAttr("required"),$("#txtCadAlugVlrIR").attr("readonly","readonly"),$("#BtnModalDetalheAlugSalvar").attr("disabled","disabled"),$("#BtnModalDetalheAlugSalvar").addClass("disabled")),$("#PopModalDetalheAluguel").modal({backdrop:"static"})):fCriarAlertaPrinc(TP_ALERTA_ERRO,i)},error:function(a){fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}})}catch(a){fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fValidarDados(){try{fLimparAreaAlertaModalCad();var a=$("#txtCadAlugData").val(),t=$("#txtCadAlugAtivo").val(),r=$("#txtCadAlugVlrBruto").val(),l="";return""==a&&(l+=" - Data<br/>"),""==t&&(l+=" - Ativo<br/>"),""!=r&&",00"!=r&&"0,00"!=r||(l+=" - Valor Bruto<br/>"),""==l||(fCriarAlertaModalCad(TP_ALERTA_AVISO,"Os seguintes campos não estão preenchido: <br/>"+l),!1)}catch(a){return fCriarAlertaModalCad(TP_ALERTA_ERRO,MSG_ALERTA_ERRO),!1}}function fSalvarDadosAluguel(a){try{if(!fValidarDados())return!1;iniciarAnimacaoSalvar();var t=$("#txtCadAlugId").val(),r=$("#txtCadAlugData").val(),l=$("#txtCadAlugAtivo").val(),i=$("#txtCadAlugVlrBruto").val(),e=$("#txtCadAlugVlrIR").val(),o=$("#txtCadAlugVlrLiquido").val();$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:a+"aluguel/salvar",data:{Id:t,Data:tirarFormacataoData(r),CodAtivo:l,VlrBruto:i,VlrIR:e,VlrLiquido:o},success:function(t){finalizarAnimacaoSalvar();var r=t.data.Resultado,l=t.data.Mensagem;if("NSESSAO"==r)return $(location).attr("href",a+"/login"),!1;"NOK"!=r?"FALHA"!=r&&"OK"==r?(fLimparDadosModalAluguel(),$("#PopModalDetalheAluguel").modal("hide"),fCriarAlertaPrinc(TP_ALERTA_SUCESSO,"Dados salvo com sucesso!"),buscar_todos_codigos_alugueis_acoes(a,"txtFiltroAlugAtivo",!1,!0,!1),fCarregarGrid(a)):fCriarAlertaModalCad(TP_ALERTA_ERRO,l):fCriarAlertaModalCad(TP_ALERTA_AVISO,l)},error:function(a,t,r){finalizarAnimacaoSalvar(),fCriarAlertaModalCad(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}})}catch(a){return finalizarAnimacaoSalvar(),void CriarAlertaModal(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fChamarPagExclusaoCorret(a){try{if($("#txtDelAlugId").val(""),""==a)return void fCriarAlertaPrinc(TP_ALERTA_AVISO,"Id. Aluguel não informado!");$("#PopModalDelAluguel").modal({backdrop:"static"}),$("#txtDelAlugId").val(a)}catch(a){$("#PopModalDelAluguel").modal("hide"),finalizarAnimacaoExcluir(),fCriarAlertaPrinc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function fExcluirDadosAluguel(a){try{finalizarAnimacaoExcluir();var t=$("#txtDelAlugId").val();if(""==t)return void fCriarAlertaModalExc(TP_ALERTA_AVISO,"Id. Aluguel não informado!");iniciarAnimacaoExcluir(),$.ajax({dataType:"json",type:"post",url:a+"aluguel/excluir",data:{IdAlug:t},success:function(t){finalizarAnimacaoExcluir();var r=t.data.Resultado,l=t.data.Mensagem;return"NSESSAO"==r?($(location).attr("href",a+"/login"),!1):"NOK"==r?(fCriarAlertaModalExc(TP_ALERTA_AVISO,l),!1):"FALHA"==r?void fCriarAlertaModalExc(TP_ALERTA_ERRO,l):"OK"==r?(fCriarAlertaPrinc(TP_ALERTA_SUCESSO,l),$("#txtDelAlugId").val(""),$("#PopModalDelAluguel").modal("hide"),buscar_todos_codigos_alugueis_acoes(a,"txtFiltroAlugAtivo",!1,!0,!1),fCarregarGrid(a),!0):(fCriarAlertaModalExc(TP_ALERTA_ERRO,l),!1)},error:function(a){$("#PopModalDelAluguel").modal("hide"),finalizarAnimacaoExcluir(),fCriarAlertaModalExc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}})}catch(a){$("#PopModalDelAluguel").modal("hide"),finalizarAnimacaoExcluir(),fCriarAlertaModalExc(TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}$(document).ready(function(){$("#MnPrincAluguel").addClass("active open"),$("#txtCadAlugVlrBruto").bind("keyup change",function(){fCalcularVlrLiquido()}),$("#txtCadAlugVlrIR").bind("keyup change",function(){fCalcularVlrLiquido()}),fLimparAreaAlertaPrinc(),fLimparAreaAlertaModalCad(),fLimparAreaAlertaModalExc()});