async function fLimparGridResumoOper(e){promise=new Promise((a,t)=>{fLimparAreaAlerta("AreaAlertaPrincAnaliseResumoOper"),$("#DivAnaliseResumoOperTotCompra").text("R$ 0,00"),$("#DivAnaliseResumoOperTotVenda").text("R$ 0,00"),$("#DivAnaliseResumoOperTotValorizacao").text("R$ 0,00 (0,00%)"),$("#DivAnaliseResumoOperTotProvento").text("R$ 0,00"),$("#DivAnaliseResumoOperTotGanhoPerda").text("R$ 0,00 (0,00%)"),fLimparSomenteGridResumoOper(e),a(!0)}).then(e=>{}).catch(e=>{})}async function fLimparSomenteGridResumoOper(e){try{promise=new Promise((e,a)=>{$("th").addClass("text-center"),$("#GridAnaliseResumoOper").dataTable().fnClearTable(),$("#GridAnaliseResumoOper").dataTable({bDestroy:!0}).fnDestroy(),$("#GridAnaliseResumoOper").DataTable({oLanguage:fTraduzirGrid(),aoColumns:[{bSortable:!0,sWidth:"50px",targets:0},{bSortable:!0,sWidth:"50px",targets:1},{bSortable:!0,sWidth:"50px",targets:2},{bSortable:!0,sWidth:"50px",targets:3},{bSortable:!0,sWidth:"50px",targets:4},{bSortable:!0,sWidth:"50px",targets:5},{bSortable:!0,sWidth:"50px",targets:6},{bSortable:!0,sWidth:"50px",targets:7},{bSortable:!0,sWidth:"50px",targets:8},{bSortable:!0,sWidth:"50px",targets:9}],order:[],bFilter:!1,bInfo:!1,bLengthChange:!1,searchable:!1,orderable:!1,bAutoWidth:!1,bPaginate:!1,ordering:!1}),e(!0)}).then(e=>{}).catch(e=>{fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(e){fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fMontarGridAnaliseResumoOper(e,a){try{promise=new Promise((t,r)=>{var o=0,i=0,l=0,s=0,n=0,d=0,A=0;$("#GridAnaliseResumoOper").dataTable().fnClearTable(),$("#GridAnaliseResumoOper").dataTable({bDestroy:!0}).fnDestroy(),$("#GridAnaliseResumoOper").DataTable({processing:!0,serverSide:!1,iDisplayLength:10,oLanguage:fTraduzirGrid(),data:a,aoColumns:[{bSortable:!0,sWidth:"50px",targets:0,render:function(e,a,t){return"display"==a&&"ACAO"==t[0]?"AçÃO":e}},{bSortable:!0,sWidth:"50px",targets:1},{bSortable:!0,sWidth:"50px",targets:2,render:function(e,a,t){return"display"==a?"R$ "+t[2]:parseFloat(GetValorDecimal(e))}},{bSortable:!0,sWidth:"50px",targets:3,render:function(e,a,t){return"display"==a?"R$ "+t[3]:parseFloat(GetValorDecimal(e))}},{bSortable:!0,sWidth:"50px",targets:4,render:function(e,a,t){return"display"==a?"R$ "+t[4]:parseFloat(GetValorDecimal(e))}},{bSortable:!0,sWidth:"50px",targets:5,render:function(e,a,t){return"display"==a?"R$ "+t[5]:parseFloat(GetValorDecimal(e))}},{bSortable:!0,sWidth:"50px",targets:6,render:function(e,a,t){return"display"==a?"R$ "+t[6]:parseFloat(GetValorDecimal(e))}},{bSortable:!0,sWidth:"50px",targets:7,render:function(e,a,t){return"display"==a?"R$ "+t[7]:parseFloat(GetValorDecimal(e))}},{bSortable:!0,sWidth:"50px",targets:8},{bSortable:!0,sWidth:"40px",targets:9,render:function(a,t,r){var o="";return"display"==t&&(CodAtivo=r[1],o+='<a class="btn btn-sm btn-primary btn-icon btn-icon-mini btn-round btn-simple" style="font-size:9px;" title="Visualizar Operações do Ativo '+CodAtivo+'" href="javascript:void(0);" onclick="fAbrirModalDetalheAnaliseOperResumo( \''+e+"', '"+CodAtivo+"' );\">",o+='   <i class="fa fa-eye fa-lg" aria-hidden="true"></i> ',o+="</a>"),o}}],createdRow:function(e,a,t){$("td",e).addClass("text-center");a[0],a[1];var r=parseFloat(GetValorDecimal(a[2])),s=parseFloat(GetValorDecimal(a[3])),A=parseFloat(GetValorDecimal(a[4])),c=parseFloat(GetValorDecimal(a[5])),p=parseFloat(GetValorDecimal(a[6])),u=parseFloat(GetValorDecimal(a[7])),m=a[8];o+=r+s,i+=A,l+=c,n+=p,d+=u,$("td",e).eq(1).addClass("font-weight-bold"),$("td",e).eq(5).addClass("font-weight-bold"),$("td",e).eq(7).addClass("font-weight-bold"),$("td",e).eq(8).addClass("font-weight-bold"),-1!=m.indexOf("ENCERRADA")&&$("td",e).css("text-decoration","line-through").addClass("font-italic"),0==c?$("td",e).eq(5).addClass("text-primary"):c>0?$("td",e).eq(5).addClass("col-teal"):c<0&&$("td",e).eq(5).addClass("col-red"),0==u?($("td",e).eq(1).addClass("table-primary"),$("td",e).eq(7).addClass("text-primary"),$("td",e).eq(8).addClass("table-primary")):u>0?($("td",e).eq(1).addClass("table-success"),$("td",e).eq(7).addClass("col-teal"),$("td",e).eq(8).addClass("table-success")):u<0&&($("td",e).eq(1).addClass("table-danger"),$("td",e).eq(7).addClass("col-red"),$("td",e).eq(8).addClass("table-danger"))},initComplete:function(e,a){s=0,0!=o&&0!=l&&(s=l/o*100),A=0,0!=o&&0!=d&&(A=d/o*100),$("#DivAnaliseResumoOperTotCompra").text("R$ "+fMascaraValor(o)),$("#DivAnaliseResumoOperTotVenda").text("R$ "+fMascaraValor(i)),$("#DivAnaliseResumoOperTotValorizacao").text("R$ "+fMascaraValor(l)+" ("+fMascaraValor(s)+"%)"),$("#DivAnaliseResumoOperTotProvento").text("R$ "+fMascaraValor(n)),$("#DivAnaliseResumoOperTotGanhoPerda").text("R$ "+fMascaraValor(d)+" ("+fMascaraValor(A)+"%)"),parseFloat(l)>0&&$("#DivAnaliseResumoOperTotValorizacao").addClass("col-teal"),parseFloat(l)<0&&$("#DivAnaliseResumoOperTotValorizacao").addClass("col-red"),parseFloat(d)>0&&$("#DivAnaliseResumoOperTotGanhoPerda").addClass("col-teal"),parseFloat(d)<0&&$("#DivAnaliseResumoOperTotGanhoPerda").addClass("col-red"),finalizarAnimacaoPesquisaResumoOper()},order:[[1,"asc"]],dom:"frtBpi",buttons:[{extend:"excelHtml5",text:'<i class="fa fa-file-excel-o"></i> Excel',className:"btn btn-outline-default btn-sm",title:NOME_PROJETO+" - Análise - Resumo Operacoes",titleAttr:"Excel",exportOptions:{columns:[0,1,2,3,4,5,6,7,8]}},{extend:"csvHtml5",charset:"UTF-8",fieldSeparator:";",titleAttr:"CSV",text:'<i class="fa fa-file-o"></i> CSV',className:"btn btn-outline-default btn-sm",title:NOME_PROJETO+" - Análise - Resumo Operacoes",bom:!0,exportOptions:{columns:[0,1,2,3,4,5,6,7,8]}},{extend:"pdfHtml5",text:'<i class="fa fa-file-pdf-o"></i> PDF',className:"btn btn-default btn-sm",titleAttr:"PDF",title:NOME_PROJETO+" - Análise - Resumo Operacoes",pageSize:"A3",alignment:"center",exportOptions:{columns:[0,1,2,3,4,5,6,7,8]},footer:!0,customize:function(e){e.defaultStyle.fontSize=12,e.styles.tableHeader.fontSize=14}},{extend:"print",text:'<i class="fa fa-print"></i> Imprimir',title:NOME_PROJETO+" - Análise - Resumo Operacoes",titleAttr:"Imprimir",className:"btn btn-default btn-sm",exportOptions:{columns:[0,1,2,3,4,5,6,7,8]}}],bFilter:!1,bInfo:!1,bLengthChange:!1,searchable:!1,orderable:!0,bAutoWidth:!1,bPaginate:!1,ordering:!0}),t(!0)}).then(e=>{}).catch(e=>{fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(a){fLimparSomenteGridResumoOper(e),null!=a.description&&fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}function iniciarAnimacaoPesquisarResumoOper(){$("#txtFiltroResumoPortfolio").attr("disabled","disabled"),fDefinirPadraoSelect("txtFiltroResumoPortfolio")}function finalizarAnimacaoPesquisaResumoOper(){$("#txtFiltroResumoPortfolio").removeAttr("disabled"),fDefinirPadraoSelect("txtFiltroResumoPortfolio")}async function fCarregarGridResumoOper(e){try{promise=new Promise((a,t)=>{fLimparAreaAlerta("AreaAlertaPrincAnaliseResumoOper"),finalizarAnimacaoPesquisaResumoOper(),iniciarAnimacaoPesquisarResumoOper();var r=$("#txtFiltroResumoPortfolio").val();$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:e+"Analise/gridResumoOper",data:{IdPortfolio:r},success:function(a){var t=a.data.Resultado,r=a.data.Mensagem,o=a.data.Lista;return"NSESSAO"==t?($(location).attr("href",e+"/login"),!1):"NOK"==t?(finalizarAnimacaoPesquisaResumoOper(),fLimparSomenteGridResumoOper(e),void fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_AVISO,r)):"FALHA"==t?(finalizarAnimacaoPesquisaResumoOper(),fLimparSomenteGridResumoOper(e),void fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_AVISO,r)):"OK"!=t?(finalizarAnimacaoPesquisaResumoOper(),fLimparSomenteGridResumoOper(e),void fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_AVISO,r)):void fMontarGridAnaliseResumoOper(e,o)},error:function(a){return finalizarAnimacaoPesquisaResumoOper(),fLimparSomenteGridResumoOper(e),fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_AVISO,MSG_ALERTA_ERRO),!1}}),a(!0)}).then(e=>{}).catch(e=>{finalizarAnimacaoPesquisaResumoOper(),fCriarAlerta("AreaAlertaPrinc",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)})}catch(a){finalizarAnimacaoPesquisaResumoOper(),fLimparSomenteGridResumoOper(e),null!=a.description&&fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_AVISO,MSG_ALERTA_ERRO)}}async function fAbrirModalDetalheAnaliseOperResumo(e,a){try{promise=new Promise((t,r)=>{fLimparAreaAlerta("AreaAlertaPrincAnaliseResumoOper"),$("#PopModalDetalheAnaliseOperResumoTit").html(a),$('.nav-tabs a[href="#AbaDetalheOperResumoOperac"]').tab("show");var o=$("#DivGridModalDetalheAnaliseOperResumoOperac");o.html("");var i=$("#DivGridModalDetalheAnaliseOperResumoProvent");i.html(""),$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:e+"Analise/gridOper",data:{CodAtivo:a},success:function(a){var t=a.data.Resultado,r=a.data.Mensagem,i=a.data.Lista;if("NSESSAO"==t)return $(location).attr("href",e+"/login"),!1;if("NOK"==t)return $("#PopModalDetalheAnaliseOperResumo").modal("hide"),void fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_AVISO,r);if("FALHA"==t)return $("#PopModalDetalheAnaliseOperResumo").modal("hide"),void fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_ERRO,r);if("OK"==t){var l="";if(i.length>0){l+='<table class="table table-sm table-hover table-condensed nowrap" style="font-size: 12px;" border="0" cellspacing="0" width="100%" style="margin: 0px;">',l+="  <thead>",l+='    <tr style="font-size: 12px;" class="thead-dark font-weight-bold"> ',l+="      <th>Tipo</th>",l+="      <th>Categoria</th>",l+="      <th>Data</th>",l+="      <th>Quant.</th>",l+="      <th>Custo/Ação</th>",l+="      <th>Preço Médio</th>",l+="      <th>Total</th>",l+="      <th>Valorização</th>",l+="    </tr>",l+="  </thead>",l+="  <tbody>";var s=0,n=0;$.each(i,function(e,a){var t=a[0],r=a[1],o=a[3],i=a[4],d=a[5],A=a[6],c=a[7],p=parseFloat(GetValorDecimal(a[8]));"Compra"!=t&&"Bonificação"!=t||(s+=parseFloat(GetValorDecimal(c))),"Venda"!=t&&"Projetado"!=t||(n+=parseFloat(GetValorDecimal(c)));var u="text-dark";"Venda"!=t&&"Projetado"!=t||(p>0&&(u="col-teal"),p<0&&(u="col-red")),l+='    <tr class="text-center '+u+'" > ',l+='      <td style="width:auto;">'+t+"</td>",l+='      <td style="width:auto;">'+r+"</td>",l+='      <td style="width:auto;">'+o+"</td>",l+='      <td style="width:auto;">'+i+"</td>",l+='      <td style="width:auto;">R$ '+d+"</td>",l+='      <td style="width:auto;">R$ '+A+"</td>",l+='      <td style="width:auto;">R$ '+c+"</td>",l+='      <td class="font-weight-bold" style="width:auto;">'+(0!=p?"R$ "+a[8]:"")+"</td>",l+="    </tr>"});var d=n-s,A=0;0!=s&&0!=d&&(A=d/s*100),textCor="text-dark",d>0&&(textCor="col-teal"),d<0&&(textCor="col-red"),l+='    <tr style="font-size: 12px;" class="text-center '+textCor+' font-weight-bold" > ',l+="      <td> TOTAL </td>",l+="      <td> </td>",l+="      <td> </td>",l+="      <td> </td>",l+="      <td> </td>",l+="      <td> </td>",l+="      <td> </td>",l+='      <td class="font-weight-bold" >R$ '+fMascaraValor(d)+" ("+fMascaraValor(A)+"%)</td>",l+="    </tr>",l+="  </tbody>",l+="</table>"}else l="Nenhuma Operaçãp encontrada para o Ativo...";return o.html(""),o.append(l),$("#PopModalDetalheAnaliseOperResumo").modal({backdrop:"static"}),!0}return $("#PopModalDetalheAnaliseOperResumo").modal("hide"),void fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_ERRO,r)},error:function(e){$("#PopModalDetalheAnaliseOperResumo").modal("hide"),fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}),$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:e+"proventos/grid",data:{CodAtivo:a,TipoRend:"",DataIni:"",DataFim:tirarFormacataoData(fDataAtual()),Corretora:""},success:function(a){var t=a.data.Resultado,r=a.data.Mensagem,o=a.data.Lista;if("NSESSAO"==t)return $(location).attr("href",e+"/login"),!1;if("NOK"==t)return $("#PopModalDetalheAnaliseOperResumo").modal("hide"),void fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_AVISO,r);if("FALHA"==t)return $("#PopModalDetalheAnaliseOperResumo").modal("hide"),void fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_ERRO,r);if("OK"==t){var l="";if(o.length>0){l+='<table class="table table-sm table-hover table-condensed nowrap" style="font-size: 12px;" border="0" cellspacing="0" width="100%" style="margin: 0px;">',l+="  <thead>",l+='    <tr style="font-size: 12px;" class="thead-dark font-weight-bold"> ',l+="      <th>Data Ex.</th>",l+="      <th>Data Pagto</th>",l+="      <th>Código</th>",l+="      <th>Tipo</th>",l+="      <th>Quant.</th>",l+="      <th>Preço</th>",l+="      <th>Total</th>",l+="    </tr>",l+="  </thead>",l+="  <tbody>";var s=0;$.each(o,function(e,a){var t=a[0],r=a[1],o=a[2],i=a[3],n=(a[4],a[5]),d=parseFloat(GetValorDecimal(a[6])),A=parseFloat(GetValorDecimal(a[7]));a[8],a[8];s+=A,l+='    <tr class="text-center text-dark" > ',l+='      <td style="width:auto;">'+colcarFormacataoData(t)+"</td>",l+='      <td style="width:auto;">'+colcarFormacataoData(r)+"</td>",l+='      <td class="font-weight-bold" style="width:auto;">'+o+"</td>",l+='      <td style="width:auto;">'+i+"</td>",l+='      <td style="width:auto;">'+colcarFormacataoInteiro(n)+"</td>",l+='      <td style="width:auto;">R$ '+fMascaraValor(d)+"</td>",l+='      <td class="font-weight-bold" style="width:auto;">R$ '+fMascaraValor(A)+"</td>",l+="    </tr>"}),l+='    <tr style="font-size: 12px;" class="text-center text-dark font-weight-bold" > ',l+="      <td> </td>",l+="      <td> </td>",l+='      <td class="font-weight-bold" style="width:auto;">TOTAL</td>',l+="      <td> </td>",l+="      <td> </td>",l+="      <td> </td>",l+='      <td class="font-weight-bold" >R$ '+fMascaraValor(s)+"</td>",l+="    </tr>",l+="  </tbody>",l+="</table>"}else l="Nenhum Provento encontrado para o Ativo no Período...";return i.html(""),i.append(l),$("#PopModalDetalheAnaliseOperResumo").modal({backdrop:"static"}),!0}return $("#PopModalDetalheAnaliseOperResumo").modal("hide"),void fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_ERRO,r)},error:function(e){$("#PopModalDetalheAnaliseOperResumo").modal("hide"),fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}),t(!0)}).then(e=>{}).catch(e=>{})}catch(e){return $("#PopModalDetalheAnaliseOperResumo").modal("hide"),void fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}async function fCarregarListaPortfolioResumoOper(e){try{promise=new Promise((a,t)=>{$("#txtFiltroResumoPortfolio").empty(),$("#txtFiltroResumoPortfolio").append('<option value="" selected>Meu Portfólio</option>'),$("#txtFiltroResumoPortfolio").append('<option value="ACAO">Minhas Ações</option>'),$("#txtFiltroResumoPortfolio").append('<option value="FII">Meus FIIs</option>'),$("#txtFiltroResumoPortfolio").append('<option value="ETF">Meus ETFs</option>'),$("#txtFiltroResumoPortfolio").append('<option value="BDR">Minhas BDRs</option>'),$.ajax({cache:"false",dataType:"json",async:!0,type:"POST",url:e+"listas/lista_nomes_carteira_user",success:function(a){var t=a.data.Resultado,r=a.data.Mensagem,o=a.data.Lista;return"NSESSAO"==t?($(location).attr("href",e+"/login"),!1):"NOK"==t?(fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_AVISO,r),!1):"FALHA"==t?(fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_ERRO,r),!1):"OK"==t?($.each(o,function(e,a){$("#txtFiltroResumoPortfolio").append('<option value="'+a[0]+'">'+a[1]+"</option>")}),fDefinirPadraoSelect("txtFiltroResumoPortfolio"),!0):(fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_ERRO,r),!1)},error:function(e){return fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_ERRO,MSG_ALERTA_ERRO),!1}}),a(!0)}).then(e=>{}).catch(e=>{})}catch(e){fCriarAlerta("AreaAlertaPrincAnaliseResumoOper",TP_ALERTA_ERRO,MSG_ALERTA_ERRO)}}